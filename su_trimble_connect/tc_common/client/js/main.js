var __extends=this&&this.__extends||function(){var n=function(a,l){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(a[f]=d[f])};return n(a,l)};return function(a,l){function k(){this.constructor=a}n(a,l);a.prototype=null===l?Object.create(l):(k.prototype=l.prototype,new k)}}();
define("DateHelper",["require","exports"],function(n,a){function l(a){return a.getUTCFullYear()+"-"+k(a.getUTCMonth()+1)+"-"+k(a.getUTCDate())+"T"+k(a.getUTCHours())+":"+k(a.getUTCMinutes())+":"+k(a.getUTCSeconds())+"-0000"}function k(a){return 10>a?"0"+a:a}Object.defineProperty(a,"__esModule",{value:!0});a.fixDueDate=a.compareDateStrings=a.convertTimeStamp=a.displayDueDate=a.ISODateString=void 0;a.ISODateString=l;a.displayDueDate=function(a){var f=(new Date).getTimezoneOffset();a=new Date(a);a.setMinutes(a.getMinutes()-
f);return a.getUTCFullYear()+"-"+k(a.getUTCMonth()+1)+"-"+k(a.getUTCDate())};a.convertTimeStamp=function(a){return(new Date(a)).toLocaleString()};a.compareDateStrings=function(a,f){var h=new Date(f);return(new Date(a)).getTime()-h.getTime()};a.fixDueDate=function(a){a=new Date(a);var f=(new Date).getTimezoneOffset();a.setDate(a.getDate()+1);a.setMinutes(f);return l(a)}});
define("l10n",["require","exports"],function(n,a){function l(){if(!k){var a;a:{a=window.location.search.substr(1).split("&");for(var f=0;f<a.length;f++){var h=a[f].split("=");if("hl"===h[0]&&1<h.length){a=decodeURIComponent(h[1]);break a}}a=void 0}if(!a)a:{a=document.cookie.split(/\s*;\s*/);for(f=0;h=a[f];f++){if(0===h.lastIndexOf("hl=",0)){a=h.substr(3);break a}if("hl"===h){a="";break a}}a="en"}k=a||"en"}k&&"en-us"===k.toLowerCase()&&(k="en");return k=k.toLowerCase()}Object.defineProperty(a,"__esModule",
{value:!0});a.$t=a.isEnglish=a.forceEnglish=a.getCurrentLanguage=a.getLanguageFilePath=a.strings=void 0;var k;a.strings=void 0;a.getLanguageFilePath=function(a){var f=l();if("en"!==f)return a+f+".js"};a.getCurrentLanguage=l;a.forceEnglish=function(a){k="en"};a.isEnglish=function(a){return"en"===a};a.$t=function(d){if(!a.strings)return d;var f=l(),f=a.strings[f];return f?(f=f[d])?f:d:d}});
define("FileUtils",["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.getValidSKPName=a.ArrayBufferToBase64=a.StripExtension=void 0;a.StripExtension=function(a){var k=goog.string.path.extension(a);0<k.length&&(a=a.slice(0,a.length-k.length-1));return a};a.ArrayBufferToBase64=function(a){var k="";a=new Uint8Array(a);for(var d=a.byteLength,f=0;f<d;++f)k+=String.fromCharCode(a[f]);return window.btoa(k)};a.getValidSKPName=function(a){goog.string.endsWith(a,".skp")||
(a+=".skp");return a}});
define("TC-Object",["require","exports","FileUtils","DateHelper","l10n"],function(n,a,l,k,d){Object.defineProperty(a,"__esModule",{value:!0});a.Task=a.Group=a.MultiUser=a.NullAssignee=a.User=a.Assignee=a.UserStatus=a.TaskStatus=a.TaskPriority=a.Type=void 0;a.Type={view:"VIEW",file:"FILE",folder:"FOLDER",user:"USER",group:"GROUP",clash:"CLASH",release:"RELEASE",todo:"TODO"};(function(b){b[b.CRITICAL=0]="CRITICAL";b[b.HIGH=1]="HIGH";b[b.NORMAL=2]="NORMAL";b[b.LOW=3]="LOW"})(a.TaskPriority||(a.TaskPriority=
{}));(function(b){b[b.NEW=0]="NEW";b[b.IN_PROGRESS=1]="IN_PROGRESS";b[b.RESOLVED=2]="RESOLVED";b[b.BLOCKED=3]="BLOCKED";b[b.CLOSED=4]="CLOSED"})(a.TaskStatus||(a.TaskStatus={}));a.UserStatus={ACTIVE:"ACTIVE",PENDING:"PENDING",REMOVED:"REMOVED"};var f=function(){function b(b){this.hasDetails_=!1;this.id_=b.id;this.type_=b.type}Object.defineProperty(b.prototype,"id",{get:function(){return this.id_},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"type",{get:function(){return this.type_},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasDetails",{get:function(){return this.hasDetails_},set:function(b){this.hasDetails_=b},enumerable:!1,configurable:!0});b.prototype.isNull=function(){return!1};b.prototype.getThumbnailUrl=function(){return""};b.prototype.setThumbnailData=function(b){this.thumbnailData_=l.ArrayBufferToBase64(b)};b.newNull=function(){return new g};b.newMulti=function(){return new m};return b}();a.Assignee=f;var h=function(b){function e(e){var a=b.call(this,
e)||this;a.firstName_=e.firstName;a.lastName_=e.lastName;a.thumbnail_=e.thumbnail;a.email_=e.email;return a}__extends(e,b);Object.defineProperty(e.prototype,"id",{get:function(){return this.id_},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"type",{get:function(){return this.type_},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"email",{get:function(){return this.email_},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"thumbnailData",{get:function(){return this.thumbnailData_},
enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"firstName",{get:function(){return this.firstName_},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"lastName",{get:function(){return this.lastName_},enumerable:!1,configurable:!0});e.prototype.defaultThumbnail=function(){return"images/dlg_user.svg"};e.prototype.getInitials=function(){var b="";goog.isDefAndNotNull(this.firstName_)&&(b+=this.firstName_[0]);goog.isDefAndNotNull(this.lastName_)&&(b+=this.lastName_[0]);
goog.string.isEmpty(b)&&(b=this.email_.slice(0,1));return b.toUpperCase()};e.prototype.displayName=function(){var b="",e=!1,p=!1;goog.isDefAndNotNull(this.firstName_)&&!goog.string.isEmpty(this.firstName_)&&(b+=this.firstName_,e=!0);goog.isDefAndNotNull(this.lastName_)&&!goog.string.isEmpty(this.lastName_)&&(e&&(b+=" "),b+=this.lastName_,p=!0);e||p||goog.isDefAndNotNull(this.email_)&&(goog.string.isEmpty(this.email_)||(b=goog.string.splitLimit(this.email_,"@",1)[0]));return b};e.prototype.hasThumbnail=
function(){return goog.isDefAndNotNull(this.thumbnail_)&&!goog.string.isEmpty(this.thumbnail_)?!0:!1};e.prototype.hasThumbnailData=function(){return goog.isDefAndNotNull(this.thumbnailData_)&&!goog.string.isEmpty(this.thumbnailData_)?!0:!1};e.prototype.getThumbnail=function(){return this.hasThumbnail()&&this.hasThumbnailData()?"data:image/bmp;base64, "+this.thumbnailData_:null};e.prototype.getThumbnailUrl=function(){return this.thumbnail_};return e}(f);a.User=h;var g=function(b){function e(){return b.call(this,
{})||this}__extends(e,b);e.prototype.getInitials=function(){return"?"};e.prototype.defaultThumbnail=function(){return"images/dlg_assign_user.svg"};e.prototype.getThumbnail=function(){return this.defaultThumbnail()};e.prototype.hasThumbnailData=function(){return!1};e.prototype.isNull=function(){return!0};e.prototype.displayName=function(){return d.$t("None")};e.prototype.hasThumbnail=function(){return!1};Object.defineProperty(e.prototype,"hasDetails",{get:function(){return!0},enumerable:!1,configurable:!0});
return e}(f);a.NullAssignee=g;var m=function(b){function e(){return b.call(this,{id:null,type:null})||this}__extends(e,b);e.prototype.isNull=function(){return!1};e.prototype.getInitials=function(){return".."};e.prototype.defaultThumbnail=function(){return"images/dlg_user_group.svg"};e.prototype.getThumbnail=function(){return this.defaultThumbnail()};e.prototype.hasThumbnail=function(){return!1};e.prototype.hasThumbnailData=function(){return!1};e.prototype.displayName=function(){return d.$t("Multiple")};
Object.defineProperty(e.prototype,"hasDetails",{get:function(){return!0},enumerable:!1,configurable:!0});return e}(f);a.MultiUser=m;var c=function(b){function e(e){var a=b.call(this,e)||this;a.name_=e.name;a.projectId_=e.projectId;return a}__extends(e,b);Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"projectId",{get:function(){return this.projectId_},enumerable:!1,configurable:!0});e.prototype.defaultThumbnail=
function(){return"images/dlg_user_group.svg"};e.prototype.getInitials=function(){var b="";goog.isDefAndNotNull(this.name_[0])&&(b+=this.name_[0]);goog.isDefAndNotNull(this.name_[1])&&(b+=this.name_[1]);return b.toUpperCase()};e.prototype.displayName=function(){return goog.isDefAndNotNull(this.name_)&&!goog.string.isEmpty(this.name_)?this.name_:""};e.prototype.hasThumbnail=function(){return!1};e.prototype.hasThumbnailData=function(){return!1};e.prototype.getThumbnail=function(){return this.defaultThumbnail()};
Object.defineProperty(e.prototype,"hasDetails",{get:function(){return!0},enumerable:!1,configurable:!0});return e}(f);a.Group=c;n=function(){function b(b){this.id=b.id;this.label=b.label;this.description=b.description;this.dueDate=b.dueDate;this.status=b.status;this.priority=b.priority;this.projectId=b.projectId;this.attachments=b.attachments;this.createdOn=b.createdOn;goog.isDefAndNotNull(this.attachments)||(this.attachments=[]);this.assignees=b.assignees;goog.isDefAndNotNull(this.assignees)?this.assigneesCSV=
this.getAssigneeListCSV(b.assignees):(this.assignees=[],this.assigneesCSV="");goog.isDefAndNotNull(this.dueDate)?this.displayDueDate=k.displayDueDate(this.dueDate):this.displayDueDate=null;this.view=null}b.defaultTask=function(e){return new b({id:"",label:"",description:"",dueDate:null,status:b.statusOptions[0],priority:b.priorityOptions[1],projectId:e,assignees:[]})};b.prototype.getDisplayedAssignee=function(){var b=this.assignees;if(1<b.length)return f.newMulti();if(1==b.length){b=b[0];if(b.type==
a.Type.user)return new h(b);if(b.type==a.Type.group)return new c(b)}return f.newNull()};b.prototype.addAttachment=function(b,m){var g={id:b,type:m,embedded:m==a.Type.view?!0:!1};Array.isArray(this.attachments)||(this.attachments=[]);this.attachments.push(g)};b.prototype.removeAttachment=function(b){var a,m=!1;this.attachments.forEach(function(p,m){p.id===b&&(a=m)});a&&(this.attachments.splice(a),m=!0);return m};b.prototype.removeAllAttachments=function(){this.attachments=[]};b.prototype.includesModel=
function(b){var a=!1;this.attachments.forEach(function(m){m.id==b&&(a=!0)});goog.isDefAndNotNull(this.view)&&Array.isArray(this.view.files)&&this.view.files.forEach(function(m){m===b&&(a=!0)});return a};b.prototype.getDifference=function(b){var a={};this.description.trim()!=b.description.trim()&&(a.description=b.description);this.status!=b.status&&(a.status=b.status);this.priority!=b.priority&&(a.priority=b.priority);this.hasDifferentAssignees(b)&&(a.assignees=b.assignees);this.hasDifferentDueDate(b)&&
(a.dueDate=b.dueDate);return a};b.prototype.getViewAttachment=function(){for(var b=this.attachments,m=0;m<b.length;++m)if(b[m].type==a.Type.view&&b[m].embedded)return b[m];return null};b.prototype.hasDifferentAssignees=function(b){if(this.assignees.length!=b.assignees.length)return!0;this.assignees.forEach(function(a,m,p){if(p[m].id!=b.assignees[m].id)return!0});return!1};b.prototype.hasDifferentDueDate=function(b){var a=Date.parse(this.dueDate);b=Date.parse(b.dueDate);return a==b||isNaN(a)&&isNaN(b)?
!1:!0};b.prototype.getThumbnailURL=function(){var b;if(goog.isDefAndNotNull(this.attachments))for(var a=0,m=this.attachments;a<m.length;a++)if(b=m[a],"VIEW"==b.type&&(b=b.thumbnailUrl,goog.isDefAndNotNull))return b;return null};b.prototype.getAssigneeListCSV=function(b){for(var m=[],g=0;g<b.length;++g)if(b[g].type==a.Type.user){var p=new h(b[g]);m.push(p.displayName())}else b[g].type==a.Type.group&&(p=new c(b[g]),m.push(p.displayName()));return m.join(", ")};b.statusOptions=["NEW","IN_PROGRESS","RESOLVED",
"BLOCKED","CLOSED"];b.priorityOptions=["LOW","NORMAL","HIGH","CRITICAL"];return b}();a.Task=n});
define("TrimbleConnect","require exports ModelStorageProvider XhrUtils TC-Object ErrorHandler".split(" "),function(n,a,l,k,d,f){Object.defineProperty(a,"__esModule",{value:!0});a.TrimbleConnect=void 0;var h;(function(a){a[a.FULL_ACCESS=0]="FULL_ACCESS";a[a.NO_ACCESS=1]="NO_ACCESS";a[a.READ=2]="READ"})(h||(h={}));n=function(){function a(m){this.connectClientIdentifier_=m;this.errorHandler_=new f.ErrorHandler}Object.defineProperty(a.prototype,"token",{get:function(){return this.token_},enumerable:!1,
configurable:!0});a.prototype.baseURL=function(a){return this.getRegionURLFromLocation(a)+this.CONNECT_API_ENDPOINT};Object.defineProperty(a.prototype,"name",{get:function(){return"Trimble Connect"},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"iconURL",{get:function(){return"images/tb_connect_icon.svg"},enumerable:!1,configurable:!0});a.prototype.initialize=function(a){this.TOKEN_URL=a.tokenUrl;this.CONNECT_BASE_URL=a.connectBaseUrl;this.CONNECT_API_ENDPOINT=a.connectAPIEndPoint;
this.USER_AGENT=a.userAgent;goog.isDefAndNotNull(a.connectClientIdentifier)&&(this.connectClientIdentifier_=a.connectClientIdentifier);return this.refreshToken()};a.prototype.refreshToken=function(){var a=this,c=this.doTokenRequest().then(function(b){if(b.error)throw Error("Problem fetching connect token: "+b.error);a.token_=b.token}),c=c.then(function(){return a.getLicenses()});return c=c.then(function(){return a.getRegions()})};a.prototype.doTokenRequest=function(){var a=k.crossDomainRequest(this.TOKEN_URL+
"?client="+this.connectClientIdentifier_);return a=a.then(function(a){return JSON.parse(a)})};a.prototype.getLicenses=function(){var a=this,c=this.doRequest(this.CONNECT_BASE_URL,"/users/licenses").promise;return c=c.then(function(b){a.licenses_=JSON.parse(b)})};a.prototype.getProjectsOrCreateDefault=function(){var a=this;this.projectIdRegionIndexMap_={};for(var c=[],b=0;b<this.regions_.length;++b){var e=this.doRequest(this.regions_[b].origin,"/projects");c.push(e)}var g=[];c.forEach(function(b,p){var t=
a.regions_[p],e={promise:b.promise.then(function(b){return a.parseProjectsArrayOrCreateDefault(b,t).then(function(b){return a.convertProjects(b,p)})}),cancel:function(){b.cancel()}};g.push(e)});return g};a.prototype.parseProjectsArrayOrCreateDefault=function(a,c){var b=JSON.parse(a),b=b.filter(function(b){return b.access===h[h.FULL_ACCESS]}),e=goog.Promise.resolve(b);c.isMaster&&0==b.length&&(e=this.createDefaultProject(),e=e.then(function(a){a=JSON.parse(a);b.push(a);return b},void 0,this));return e};
a.prototype.convertProjects=function(a,c){for(var b=[],e=this.regions_[c],g=0;g<a.length;g++){var q=a[g],q={region:e.location,id:q.id,name:q.name,thumbnailURL:q.thumbnail,rootFolderId:q.rootId,hasChildren:!0};(new goog.Uri(q.thumbnailURL,!0)).hasDomain()||(q.thumbnailURL=this.CONNECT_BASE_URL+q.thumbnailURL);b.push(q);this.projectIdRegionIndexMap_[q.id]=c}return b};a.prototype.getProjectsSynchronous=function(){var a=this.getProjectsOrCreateDefault().map(function(a){return a.promise});return goog.Promise.all(a)};
a.prototype.getRegionForProject=function(a){var c=this,b=goog.Promise.resolve();this.projectIdRegionIndexMap_&&void 0!==this.projectIdRegionIndexMap_[a]||(b=this.getProjectsSynchronous());return b=b.then(function(){var b=c.projectIdRegionIndexMap_[a];return void 0!==b?c.regions_[b].location:goog.Promise.reject()},void 0,this)};a.prototype.getLatestVersionId=function(a,c){var b=this.getRegionURLFromLocation(a),b=this.doRequest(b,"/files/"+c+"/versions","GET").promise;return b=b.then(function(b){b=
JSON.parse(b);return 0<b.length?b[0].versionId:goog.Promise.reject()})};a.prototype.createDefaultProject=function(){var a=this;if(!goog.isDefAndNotNull(this.defaultProjectPromise_)){var c=this.regions_[this.masterRegionIndex_].origin,b={name:"SketchUp"};goog.isDefAndNotNull(this.licenses_)&&0<this.licenses_.length&&(b.licenseId=this.licenses_[0].id);this.defaultProjectPromise_=this.doRequest(c,"/projects","POST",JSON.stringify(b),!0).promise.thenAlways(function(){a.defaultProjectPromise_=void 0}).thenCatch(function(b){throw b;
})}return this.defaultProjectPromise_};a.prototype.defaultAlignment=function(a){return{fileId:a,axisX:0,axisY:0,axisZ:1,locationX:0,locationY:0,locationZ:0,refDirectionX:1,refDirectionY:0,refDirectionZ:0}};a.prototype.getRegions=function(){var a=this;if(goog.isDefAndNotNull(this.regions_)&&0<this.regions_.length)return goog.Promise.resolve();this.regions_=[];this.masterRegionIndex_=-1;var c=this.doRequest(this.CONNECT_BASE_URL,"/regions").promise;return c=c.then(function(b){b=JSON.parse(b);for(var e=
0;e<b.length;++e){var c=b[e],g=c.origin;goog.string.startsWith(g,"//")&&(g="https:"+g);c.origin=g;c.isMaster&&(a.masterRegionIndex_=e);a.regions_.push(c)}},void 0,this)};a.prototype.getRegionURLFromLocation=function(a){for(var c=0;c<this.regions_.length;++c)if(this.regions_[c].location==a)return this.regions_[c].origin;throw Error("Could not find the region for location "+a);};a.prototype.getContents=function(a,c){var b=this,e=this.getRegionURLFromLocation(a),e=this.doRequest(e,"/folders/"+c+"/items").promise;
return e=e.then(function(e){var c=[];e=JSON.parse(e);for(var p=0;p<e.length;p++){var t=b.convertResponseToFolderItem(e[p],a);c.push(t)}return c},void 0,this)};a.prototype.convertResponseToFolderItem=function(a,c){var b={id:a.id,createdOn:a.createdOn,modifiedOn:a.modifiedOn,region:c,parentFolderId:a.parentId,projectId:a.projectId,versionId:a.versionId,name:a.name,type:"FOLDER"===a.type?l.FolderItemType.Folder:l.FolderItemType.File,size:a.size,thumbnailURL:a.thumbnailUrl?a.thumbnailUrl[0]:void 0,hasChildren:"FOLDER"===
a.type?!0:!1};a.createdBy&&(b.createdByEmail=a.createdBy.email,b.createdByFirstName=a.createdBy.firstName,b.createdByLastName=a.createdBy.lastName);a.modifiedBy&&(b.modifiedByEmail=a.modifiedBy.email,b.modifiedByFirstName=a.modifiedBy.firstName,b.modifiedByLastName=a.modifiedBy.lastName);return b};a.prototype.downloadFile=function(a,c,b,e){a=this.getRegionURLFromLocation(a);return this.doRequest(a,"/files/"+c+"/content?versionId="+b,"GET",null,!1,!0,e)};a.prototype.uploadFile=function(a,c,b,e,g){a=
this.getRegionURLFromLocation(a);var q=new FormData;q.append(c,e,c);var p=this.doRequest(a,"/files?parentId="+b,"POST",q,!1,!1,g);return{promise:p.promise.then(function(b){b=JSON.parse(b)[0];return{projectId:b.projectId,parentFolderId:b.parentId,fileId:b.id,versionId:b.versionId}}),cancel:function(){p.cancel()}}};a.prototype.downloadThumbnail=function(a){return this.doRequest(a,"","GET",null,!1,!0).promise};a.prototype.createFolder=function(a,c,b){var e=this,g=this.getRegionURLFromLocation(a);return this.doRequest(g,
"/folders","POST",JSON.stringify({name:c,parentId:b}),!0).promise.then(function(b){b=JSON.parse(b);return e.convertResponseToFolderItem(b,a)})};a.prototype.deleteFile=function(a,c){var b=this.getRegionURLFromLocation(a);return this.doRequest(b,"/files/"+c,"DELETE").promise.then(function(){return!0})};a.prototype.deleteFolder=function(a,c){var b=this.getRegionURLFromLocation(a);return this.doRequest(b,"/folders/"+c,"DELETE").promise.then(function(){return!0})};a.prototype.getErrorTypeFromErrorString=
function(a){return"INVALID_OPERATION_DELETED"===a?l.ErrorType.ItemWasDeleted:"ALIGNMENT_NOT_FOUND"===a?l.ErrorType.ModelNotAligned:l.ErrorType.UnknownError};a.prototype.getFolderDetails=function(a,c){var b=this,e=this.getRegionURLFromLocation(a);return this.doRequest(e,"/folders/"+c).promise.then(function(e){e=JSON.parse(e);return b.convertResponseToFolderItem(e,a)})};a.prototype.getFileDetails=function(a,c){var b=this.getRegionURLFromLocation(a);return this.doRequest(b,"/files/"+c).promise.then(function(b){return JSON.parse(b)})};
a.prototype.doRequest=function(a,c,b,e,g,q,p){void 0===b&&(b="GET");0<c.length&&(a+=this.CONNECT_API_ENDPOINT+c);return k.doRequest(a,b,e,{Authorization:"Bearer "+this.token_,"X-TrimbleConnect-Client":this.connectClientIdentifier_},g,q,p)};a.prototype.getTasks=function(a,c){var b=this.getRegionURLFromLocation(a),b=this.doRequest(b,"/todos?projectId="+c).promise;return b=b.then(function(b){var a=[];b=JSON.parse(b);for(var c=0;c<b.length;c++){var p=new d.Task(b[c]);a.push(p)}return a},void 0,this)};
a.prototype.getTaskDetails=function(a,c,b){a=this.getRegionURLFromLocation(a);b=this.doRequest(a,"/todos/"+b).promise;return b=b.then(function(b){b=JSON.parse(b);return new d.Task(b)},void 0,this)};a.prototype.publishTask=function(a,c,b){a=this.getRegionURLFromLocation(a);return this.doRequest(a,"/todos","POST",JSON.stringify(b),!0).promise.then(function(b){b=JSON.parse(b);return new d.Task(b)})};a.prototype.updateTask=function(a,c,b){a=this.getRegionURLFromLocation(a);return this.doRequest(a,"/todos/"+
c,"PATCH",JSON.stringify(b),!0).promise.then(function(b){console.log("Update Task Response");console.log(JSON.parse(b));b=JSON.parse(b);return new d.Task(b)})};a.prototype.deleteTask=function(a,c){var b=this.getRegionURLFromLocation(a);return this.doRequest(b,"/todos/"+c,"DELETE").promise.then(function(){return!0})};a.prototype.getAlignment=function(a,c){var b=this,e=this.getRegionURLFromLocation(a),e=this.doRequest(e,"/files/"+c+"/alignment").promise;return e=e.then(function(b){return JSON.parse(b)},
function(a){return b.defaultAlignment(c)})};a.prototype.publishAlignment=function(a,c,b){console.log("Alignment data being published:");console.log(b);a=this.getRegionURLFromLocation(a);return this.doRequest(a,"/files/"+c+"/alignment","PUT",JSON.stringify(b),!0).promise.then(function(b){return JSON.parse(b)})};a.prototype.publishView=function(a,c,b){a=this.getRegionURLFromLocation(a);return this.doRequest(a,"/views","POST",JSON.stringify(b),!0).promise.then(function(b){return JSON.parse(b)})};a.prototype.updateView=
function(a,c,b){a=this.getRegionURLFromLocation(a);c=this.doRequest(a,"/views/"+c,"PATCH",JSON.stringify(b),!0).promise;return c=c.then(function(b){return JSON.parse(b)})};a.prototype.deleteView=function(a,c){var b=this.getRegionURLFromLocation(a);return this.doRequest(b,"/views/"+c,"DELETE").promise.then(function(){return!0})};a.prototype.getViewDetails=function(a,c){var b=this,g=this.getRegionURLFromLocation(a),g=this.doRequest(g,"/views/"+c).promise;return g=g.then(function(b){return JSON.parse(b)}).thenCatch(function(a){return b.errorHandler_.getCode(a)==
f.code.VIEW_NOT_FOUND?goog.Promise.resolve(null):goog.Promise.reject(a)})};a.prototype.publishTaskAttachments=function(a,c,b,g){a=this.getRegionURLFromLocation(a);return this.doRequest(a,"/todos/"+b.id+"/attachments","POST",JSON.stringify(g),!0).promise.then(function(b){return JSON.parse(b)})};a.prototype.getTaskAttachments=function(a,c,b){a=this.getRegionURLFromLocation(a);b=this.doRequest(a,"/todos/"+b+"/attachments").promise;return b=b.then(function(b){return JSON.parse(b)},void 0,this)};a.prototype.removeAttachments=
function(a,c,b){a=this.getRegionURLFromLocation(a);return this.doRequest(a,"/todos/"+c+"/attachments","DELETE",JSON.stringify(b),!0).promise.then(function(){return!0})};a.prototype.getUsers=function(a,c){var b=this.getRegionURLFromLocation(a),b=this.doRequest(b,"/projects/"+c+"/users").promise;return b=b.then(function(a){return JSON.parse(a)},void 0,this)};a.prototype.getUserDetails=function(a,c){var b=this.getRegionURLFromLocation(a),b=this.doRequest(b,"/users/"+c).promise;return b=b.then(function(a){return JSON.parse(a)},
void 0,this)};a.prototype.getUserGroups=function(a,c){var b=this.getRegionURLFromLocation(a),b=this.doRequest(b,"/groups?projectId="+c).promise;return b=b.then(function(a){return JSON.parse(a)},void 0,this)};a.prototype.getComments=function(a,c,b){a=this.getRegionURLFromLocation(a);c=this.doRequest(a,"/comments?objectId="+c+"&objectType="+b).promise;return c=c.then(function(a){return JSON.parse(a)},void 0,this)};a.prototype.publishComment=function(a,c){var b=this.getRegionURLFromLocation(a);return this.doRequest(b,
"/comments","POST",JSON.stringify(c),!0).promise.then(function(a){return JSON.parse(a)})};return a}();a.TrimbleConnect=n});define("ModelStorageProviderFactory",["require","exports","TrimbleConnect"],function(n,a,l){Object.defineProperty(a,"__esModule",{value:!0});a.Init=a.Providers=a.ProviderKey=void 0;var k;(function(a){a[a.Trimble_Connect=0]="Trimble_Connect"})(k=a.ProviderKey||(a.ProviderKey={}));a.Init=function(d){void 0===d&&(d="");a.Providers={};a.Providers[k.Trimble_Connect]=new l.TrimbleConnect(d)}});
define("DialogPrompts",["require","exports","l10n","XhrUtils"],function(n,a,l,k){function d(a,d){a.getContentElement().innerHTML=d}function f(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.NO,!1,!0).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.YES,!0)}function h(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CANCEL,!0,!0)}Object.defineProperty(a,"__esModule",{value:!0});a.CreateCancel=a.CreateYesNo=a.CreateOkCancel=
a.SetDefaultButtonEnabled=a.ShowProgressDialog=a.ShowQuestionDialog=a.ShowInfoDialog=void 0;a.ShowInfoDialog=function(a,h,c){var b=!0;goog.isDefAndNotNull(c)||(c=goog.ui.Dialog.ButtonSet.DefaultButtons.OK.caption,b=!1);return new goog.Promise(function(e,f){var q=new goog.ui.Dialog(null);q.setDisposeOnHide(!0);q.setTitle(a);d(q,h);var p=new goog.ui.Dialog.ButtonSet;p.addButton({key:goog.ui.Dialog.ButtonSet.DefaultButtons.OK.key,caption:c},!0,!0);q.setButtonSet(p);b&&(p=q.getButtonElement().getElementsByTagName("button")[0],
goog.style.setWidth(p,300));goog.events.listen(q,goog.ui.Dialog.EventType.SELECT,function(a){e()});q.setVisible(!0)})};a.ShowQuestionDialog=function(a){return new goog.Promise(function(d,c){var b=new goog.ui.Dialog(null);b.setDisposeOnHide(!0);b.setTitle(l.$t("Please confirm"));b.setTextContent(a);b.setButtonSet(f());goog.events.listen(b,goog.ui.Dialog.EventType.SELECT,function(a){a.key==goog.ui.Dialog.DefaultButtonKeys.YES?d(!0):d(!1)});b.setVisible(!0)})};a.ShowProgressDialog=function(a,f){var c=
new goog.ui.Dialog(null);c.setDisposeOnHide(!0);c.setTitle(a);d(c,SketchUpTemplates.progressDialog());c.setVisible(!0);var b=c.getElementByClass("progress-dialog-progress-bar");c.setButtonSet(h());return{dialog:c,onProgress:function(a){b.value=k.ComputeProgressPercentage(a,f)},close:function(){c.setVisible(!1)},setCancelCallback:function(a){goog.events.listenOnce(c,goog.ui.Dialog.EventType.SELECT,function(b){b.key==goog.ui.Dialog.DefaultButtonKeys.CANCEL&&a()})}}};a.SetDefaultButtonEnabled=function(a,
d){var c=a.getButtonSet(),b=a.getElementByClass("goog-buttonset-default");d?(c.setButtonEnabled(c.getDefault(),!0),b.classList.remove("modal-dialog-button-disabled")):(c.setButtonEnabled(c.getDefault(),!1),b.classList.add("modal-dialog-button-disabled"))};a.CreateOkCancel=function(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CANCEL,!1,!0).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.OK,!0)};a.CreateYesNo=f;a.CreateCancel=h});
define("ErrorHandler",["require","exports","ModelStorageProviderFactory","DialogPrompts","l10n"],function(n,a,l,k,d){Object.defineProperty(a,"__esModule",{value:!0});a.ErrorHandler=a.ErrorContext=a.code=void 0;a.code={UNAUTHORIZED:"UNAUTHORIZED",PROJECT_NOT_DEFINED:"PROJECT_NOT_DEFINED",ACTION_ABORTED_BY_USER:"ACTION_ABORTED_BY_USER",MISSING_TODO_DESCRIPTION:"MISSING_TODO_DESCRIPTION",INVALID_ASSIGNEE:"INVALID_ASSIGNEE",INVALID_HEADER:"INVALID_HEADER",MISSING_REQUIRED_PARAMS:"MISSING_REQUIRED_PARAMS",
INVALID_PARAM:"INVALID_PARAM",USER_NOT_IN_PROJECT:"USER_NOT_IN_PROJECT",PROJECT_NOT_FOUND:"PROJECT_NOT_FOUND",PROJECT_DELETED:"PROJECT_DELETED",PERMISSION_DENIED:"PERMISSION_DENIED",NAME_TOO_LONG:"NAME_TOO_LONG",INVALID_OPERATION_OLD_REVISION:"INVALID_OPERATION_OLD_REVISION",DUPLICATE_NAME:"DUPLICATE_NAME",OBJECT_NOT_FOUND:"OBJECT_NOT_FOUND",INVALID_OPERATION_DELETED:"INVALID_OPERATION_DELETED",UPLOAD_FAILED:"UPLOAD_FAILED",FILE_NOT_READY:"FILE_NOT_READY",DOWNLOAD_FAILED:"DOWNLOAD_FAILED",DOWNLOAD_FAILED_SIZE_LIMIT:"DOWNLOAD_FAILED_SIZE_LIMIT",
INVALID_OPERATION_FILE_DELETED:"INVALID_OPERATION_FILE_DELETED",INVALID_OPERATION_FOLDER_DELETED:"INVALID_OPERATION_FOLDER_DELETED",EMPTY_FOLDER_CANNOT_CHECKOUT:"EMPTY_FOLDER_CANNOT_CHECKOUT",EMPTY_FOLDER_CANNOT_CHECKIN:"EMPTY_FOLDER_CANNOT_CHECKIN",FILE_ALREADY_CHECKED_OUT:"FILE_ALREADY_CHECKED_OUT",FILE_CHECKED_OUT_BY_ANOTHER_USER:"FILE_CHECKED_OUT_BY_ANOTHER_USER",FILE_NOT_CHECKED_OUT:"FILE_NOT_CHECKED_OUT",SAME_SOURCE_DEST_PARENT:"SAME_SOURCE_DEST_PARENT",OBJECT_NOT_IN_PROJECT:"OBJECT_NOT_IN_PROJECT",
NOT_MODIFIED:"NOT_MODIFIED",UNSUPPORTED_FILETYPE:"UNSUPPORTED_FILETYPE",ALIGNMENT_NOT_FOUND:"ALIGNMENT_NOT_FOUND",BAD_REQUEST:"BAD_REQUEST",JWT_TOKEN_INVALID:"JWT_TOKEN_INVALID",JWT_TOKEN_EXPIRED:"JWT_TOKEN_EXPIRED",API_KEY_REVOKED:"API_KEY_REVOKED",ECOM_ENTITLEMENT_DATA_FAILED:"ECOM_ENTITLEMENT_DATA_FAILED",API_KEY_GENERATION_ERROR:"API_KEY_GENERATION_ERROR",API_KEY_INVALID:"API_KEY_INVALID",INVALID_SESSION:"INVALID_SESSION",UNAUTHORIZED_LICENSE:"UNAUTHORIZED_LICENSE",INVALID_OPERATION_VIEW_DELETED:"INVALID_OPERATION_VIEW_DELETED",
INVALID_OPERATION_CLASH_DELETED:"INVALID_OPERATION_CLASH_DELETED",INVALID_OPERATION_COMMENT_DELETED:"INVALID_OPERATION_COMMENT_DELETED",INVALID_OPERATION_RELEASE_DELETED:"INVALID_OPERATION_RELEASE_DELETED",INVALID_OPERATION_TODO_DELETED:"INVALID_OPERATION_TODO_DELETED",TODO_ALREADY_DELETED:"TODO_ALREADY_DELETED",TODO_NOT_FOUND:"TODO_NOT_FOUND",RELEASE_NOT_FOUND:"RELEASE_NOT_FOUND",VIEW_NOT_FOUND:"VIEW_NOT_FOUND",VIEWGROUP_NOT_FOUND:"VIEWGROUP_NOT_FOUND",CLASH_NOT_FOUND:"CLASH_NOT_FOUND"};var f;(function(a){a[a.Unknown=
0]="Unknown";a[a.FileUpload=1]="FileUpload"})(f=a.ErrorContext||(a.ErrorContext={}));n=function(){function h(){}h.prototype.getCode=function(a){var d="";try{d=JSON.parse(a.message).errorcode}catch(c){d=a.message}return d};h.prototype.rescue=function(a){console.log("ErrorHandler caught:");console.log(a);a=this.getCode(a);this.handleErrorCode(a);return a};h.prototype.handleErrorCode=function(g,h){var c=this;void 0===h&&(h=f.Unknown);var b=l.Providers[l.ProviderKey.Trimble_Connect];switch(g){case a.code.UNAUTHORIZED:window.sketchup.sign_in();
break;case a.code.PROJECT_NOT_DEFINED:this.notify(d.$t("This model is not yet associated with a Trimble Connect project. First, publish this model to Trimble Connect or open a model from Trimble Connect.")).then(function(){return c.close()});break;case a.code.USER_NOT_IN_PROJECT:this.notify(d.$t("User does not have access to this project.")).then(function(){return c.close()});break;case a.code.PROJECT_NOT_FOUND:this.notify(d.$t("The project for this model could not be found.")).then(function(){return c.close()});
break;case a.code.PROJECT_DELETED:this.notify(d.$t("The project for this model has been deleted. Please publish this model to another project.")).then(function(){return c.close()});break;case a.code.PERMISSION_DENIED:this.notify(d.$t("You do not have permission to perform this action. Please request permission from the project administrator."));break;case a.code.NAME_TOO_LONG:this.notify(d.$t("The specified name is too long. Max length is 255 characters."));break;case a.code.DUPLICATE_NAME:this.notify(d.$t("Name already exists."));
break;case a.code.INVALID_OPERATION_DELETED:this.notify(d.$t("The specified folder has been deleted."));break;case a.code.UPLOAD_FAILED:this.notify(d.$t("File upload failed due to server error."));break;case a.code.FILE_NOT_READY:this.notify(d.$t("File is currently being processed and is not yet available."));break;case a.code.DOWNLOAD_FAILED:this.notify(d.$t("File download failed."));break;case a.code.DOWNLOAD_FAILED_SIZE_LIMIT:this.notify(d.$t("Download failed. Download size limit has been exceeded."));
break;case a.code.INVALID_OPERATION_FILE_DELETED:this.notify(d.$t("File is already deleted."));break;case a.code.INVALID_OPERATION_FOLDER_DELETED:this.notify(d.$t("Folder is already deleted."));break;case a.code.EMPTY_FOLDER_CANNOT_CHECKOUT:this.notify(d.$t("Unable to check out an empty folder."));break;case a.code.EMPTY_FOLDER_CANNOT_CHECKIN:this.notify(d.$t("Unable to check in an empty folder."));break;case a.code.FILE_ALREADY_CHECKED_OUT:this.notify(d.$t("You have already checked out this file."));
break;case a.code.FILE_CHECKED_OUT_BY_ANOTHER_USER:this.notify(d.$t("Another user has checked out this file."));break;case a.code.FILE_NOT_CHECKED_OUT:this.notify(d.$t("This file is not checked out."));break;case a.code.OBJECT_NOT_IN_PROJECT:this.notify(d.$t("You cannot move a file to another project."));break;case a.code.ALIGNMENT_NOT_FOUND:break;case a.code.ECOM_ENTITLEMENT_DATA_FAILED:this.notify(d.$t("Failed to retrieve license entitlement. Please try again."));break;case a.code.API_KEY_REVOKED:b.refreshToken().then(function(){c.notify(d.$t("API key has been revoked. Please try again."))});
break;case a.code.API_KEY_GENERATION_ERROR:b.refreshToken().then(function(){c.notify(d.$t("Unable to generate access token. Please try again."))});break;case a.code.API_KEY_INVALID:b.refreshToken().then(function(){c.notify(d.$t("Your Trimble Connect session is not valid. Please try again."))});break;case a.code.INVALID_SESSION:b.refreshToken().then(function(){c.notify(d.$t("Your Trimble Connect session is not valid. Please try again."))});break;case a.code.UNAUTHORIZED_LICENSE:b=void 0;b=h===f.FileUpload?
d.$t("No projects were found in your account and we could not create a default project. You might have exceeded the number of projects allowed in your subscription."):d.$t("This model could not be uploaded to your account because you seem to have reached your storage limit.");this.notify(b);break;case a.code.INVALID_OPERATION_VIEW_DELETED:this.notify(d.$t("The specified View has been deleted."));break;case a.code.INVALID_OPERATION_COMMENT_DELETED:this.notify(d.$t("The specified comment has been deleted."));
break;case a.code.INVALID_OPERATION_TODO_DELETED:this.notify(d.$t("The specified ToDo has been deleted."));break;case a.code.TODO_NOT_FOUND:this.notify(d.$t("The specified ToDo is not found."));break;case a.code.TODO_ALREADY_DELETED:this.notify(d.$t("The specified ToDo has been deleted."));case a.code.VIEW_NOT_FOUND:this.notify(d.$t("The specified View is not found."));break;case a.code.MISSING_TODO_DESCRIPTION:this.notify(d.$t("You must enter a description."));break;case a.code.INVALID_ASSIGNEE:this.notify(d.$t("One or more assignees for this ToDo could not be found."));
break;case a.code.ACTION_ABORTED_BY_USER:break;default:window.sketchup.debug(g)}};h.prototype.notify=function(a){var f=d.$t("Oops...");return k.ShowInfoDialog(f,a)};h.prototype.close=function(){window.sketchup.close_window()};return h}();a.ErrorHandler=n});
define("XhrUtils",["require","exports","ErrorHandler"],function(n,a,l){Object.defineProperty(a,"__esModule",{value:!0});a.ComputeProgressPercentage=a.crossDomainRequest=a.fetchBinary=a.doRequest=void 0;a.doRequest=function(a,d,f,h,g,m,c){void 0===d&&(d="GET");var b=new XMLHttpRequest;return{promise:new goog.Promise(function(e,l){b.open(d,a,!0);if(h)for(var q in h)b.setRequestHeader(q,h[q]);g&&b.setRequestHeader("Content-Type","application/json");m&&(b.responseType="arraybuffer");"POST"==d&&b.upload?
b.upload.onprogress=c:b.onprogress=c;b.onerror=function(a){l(Error("XHR error."))};b.onabort=function(a){l(Error("XHR aborted."))};b.onload=function(a){200<=b.status&&300>b.status?e(b.response):""==b.responseType||"text"==b.responseType?l(Error(b.responseText)):l(Error())};f?b.send(f):b.send()}),cancel:function(){b.abort()}}};a.fetchBinary=function(a,d,f,h){var g=h||function(a){console.error("Problem during xmlhttprequest "+a)},m=f||function(){},c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType=
"arraybuffer";c.onprogress=function(a){m(a)};c.onload=function(a){200==c.status?d(c.response):g(a)};c.send()};a.crossDomainRequest=function(a){return new goog.Promise(function(d,f){var h=new XMLHttpRequest;h.open("GET",a,!0);h.withCredentials=!0;h.onload=function(a){200==this.status?d(this.response):401==this.status?f(Error(l.code.UNAUTHORIZED)):""==h.responseType||"text"==h.responseType?f(Error(h.responseText)):f(Error())};h.onerror=function(a){f(a)};h.send()}.bind(this))};a.ComputeProgressPercentage=
function(a,d){var f=a.loaded,h=a.total;0===h&&(h=d||0);return 0<h?Math.round(f/h*100):0}});
define("ModelStorageProvider",["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.ErrorType=a.FileVersionState=a.FolderItemType=void 0;(function(a){a[a.File=0]="File";a[a.Folder=1]="Folder"})(a.FolderItemType||(a.FolderItemType={}));(function(a){a[a.UpToDate=0]="UpToDate";a[a.ModifiedAtRemoteStorage=1]="ModifiedAtRemoteStorage";a[a.ModifiedLocally=2]="ModifiedLocally";a[a.HasConflict=3]="HasConflict";a[a.DeleteAtRemoteStorage=4]="DeleteAtRemoteStorage"})(a.FileVersionState||
(a.FileVersionState={}));(function(a){a[a.UnknownError=0]="UnknownError";a[a.ItemWasDeleted=1]="ItemWasDeleted";a[a.ModelNotAligned=2]="ModelNotAligned"})(a.ErrorType||(a.ErrorType={}))});
define("FileDetailsPage",["require","exports","l10n"],function(n,a,l){Object.defineProperty(a,"__esModule",{value:!0});a.ImportRefDetailsPage=a.OpenFileDetailsPage=a.FileDetailsPage=void 0;n=function(){function a(d,h,g){this.folderItemView_=d;this.container_=h;this.openCallback_=g;this.container_.appendChild(this.getContent());this.setupOpenButton()}a.prototype.getContent=function(){var a={fileEntry:this.folderItemView_,buttonName:l.$t("Open")};return goog.soy.renderAsFragment(SketchUpTemplates.fileDetailsPage,
a)};a.prototype.setupOpenButton=function(){var a=this;this.container_.querySelector(".bottom-button").addEventListener("click",function(d){a.openCallback_(a.folderItemView_)})};a.prototype.close=function(){};return a}();a.FileDetailsPage=n;var k=function(a){function f(h,g,f){return a.call(this,h,g,f)||this}__extends(f,a);return f}(n);a.OpenFileDetailsPage=k;n=function(a){function f(h,g,f){return a.call(this,h,g,f)||this}__extends(f,a);f.prototype.getContent=function(){var a={fileEntry:this.folderItemView_,
buttonName:l.$t("Import Reference")};return goog.soy.renderAsFragment(SketchUpTemplates.fileDetailsPage,a)};return f}(n);a.ImportRefDetailsPage=n});
define("ImportFromLocalView",["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});var l=function(){function a(d,f){this.container_=d;this.importCallback_=f}a.prototype.close=function(){};a.prototype.render=function(){var a=this,f=goog.soy.renderAsFragment(SketchUpTemplates.importLocal,{});this.container_.appendChild(f);this.textArea_=f.querySelector(".import-text");this.thumbnailContainer_=f.querySelector(".preview-thumbnail");f.querySelector(".upload-button").addEventListener("click",
this.handleBrowseClick.bind(this));this.fileInput_=document.getElementById("system-file-browser");this.fileInput_.addEventListener("change",function(f){a.fileSelected(a.fileInput_.files[0])})};a.prototype.handleBrowseClick=function(a){this.fileInput_.value="";this.fileInput_.click()};a.prototype.fileSelected=function(a){this.textArea_.textContent=a.name;this.importCallback_(a)};return a}();a["default"]=l});
define("ImportDetailsPage",["require","exports","ImportFromLocalView"],function(n,a,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(d,f){this.container_=d;this.importCallback_=f;var h=goog.soy.renderAsFragment(SketchUpTemplates.importPage,{});this.container_.appendChild(h);this.content_=this.container_.querySelector(".left-details-content");this.importView_=new l["default"](this.content_,this.importCallback_);this.importView_.render()}a.prototype.close=function(){this.importView_&&
this.importView_.close()};return a}();a["default"]=n});
define("SketchUpEvent",["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.SketchUpEvents=void 0;var l=function(){function a(){this.handlers=[]}a.prototype.listen=function(a){this.handlers.push(a)};a.prototype.remove=function(a){goog.array.remove(this.handlers,a)};a.prototype.trigger=function(a){this.handlers.forEach(function(f){return f(a)})};return a}();(function(a){a.Create=function(){return new l}})(a.SketchUpEvents||(a.SketchUpEvents={}))});
define("DetailsView",["require","exports","FileDetailsPage","ImportDetailsPage"],function(n,a,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ImportRefView=a.OpenDetailsView=a.DetailsView=void 0;n=function(){function a(d,g,f,c){this.relativeContainer_=d;this.importCallback_=g;this.openCallback_=f;d=goog.soy.renderAsFragment(SketchUpTemplates.detailsView,{});document.body.appendChild(d);this.content_=d;window.addEventListener("resize",this.handleResize.bind(this));this.position();this.close();
c&&c.listen(this.close.bind(this))}a.prototype.clear=function(){this.closePages();this.content_.innerHTML=""};a.prototype.activateFileDetails=function(a){this.clear();this.makeVisible();this.fileDetailsPage_=new l.FileDetailsPage(a,this.content_,this.openCallback_)};a.prototype.activateImportPage=function(){this.clear();this.importPage_=new k["default"](this.content_,this.importCallback_)};a.prototype.handleResize=function(){this.position()};a.prototype.position=function(){var a=this.relativeContainer_;
this.content_.style.left=a.offsetWidth+a.offsetLeft+"px"};a.prototype.closePages=function(){this.importPage_&&this.importPage_.close();this.fileDetailsPage_&&this.fileDetailsPage_.close()};a.prototype.close=function(){this.content_.style.display="none";this.closePages();this.relativeContainer_.classList.remove("compressed")};a.prototype.makeVisible=function(){this.relativeContainer_.classList.add("compressed");this.content_.style.display="";this.position()};return a}();a.DetailsView=n;var d=function(a){function d(){return null!==
a&&a.apply(this,arguments)||this}__extends(d,a);d.prototype.activateFileDetails=function(g){a.prototype.clear.call(this);a.prototype.makeVisible.call(this);this.fileDetailsPage_=new l.OpenFileDetailsPage(g,this.content_,this.openCallback_)};return d}(n);a.OpenDetailsView=d;n=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}__extends(d,a);d.prototype.activateFileDetails=function(g){a.prototype.clear.call(this);a.prototype.makeVisible.call(this);this.fileDetailsPage_=new l.ImportRefDetailsPage(g,
this.content_,this.openCallback_)};return d}(n);a.ImportRefView=n});
define("EnvironmentSettings",["require","exports"],function(n,a){function l(a){return k(a)||goog.string.contains(a,"dev-my.sketchup.com")}function k(a){return goog.string.contains(a,"localhost")||goog.string.contains(a,"127.0.0.1")||goog.string.startsWith(a,"file:")||goog.string.contains(a,"localdev-my.sketchup.com")}function d(){return{connectBaseUrl:"https://app.connect.trimble.com",connectPortalEndPoint:"/tc/app#/",connectAPIEndPoint:"/tc/api/2.0",loginUsersEndPoint:"/api/v1.0/users",loginConnectTokenEndPoint:"/api/v1.0/users/connectToken",
loginServer:"https://login.sketchup.com",loginEndPoint:"/login/trimbleid",logoutEndPoint:"/logout",ADD_LOCATION_SERVICES:"/addlocation/services"}}Object.defineProperty(a,"__esModule",{value:!0});a.GetProd=a.GetTest=a.Get=a.CheckOrigin=a.IsLocalOrDev=a.IsLocal=void 0;a.IsLocal=function(){return k(window.location.href)};a.IsLocalOrDev=function(){return l(window.location.href)};a.CheckOrigin=function(a){return l(a)||goog.string.contains(a,"stg-my.sketchup.com")||goog.string.contains(a,"my.sketchup.com")};
a.Get=function(){return d()};a.GetTest=function(){return{connectBaseUrl:"https://app.stage.connect.trimble.com",connectPortalEndPoint:"/tc/app#/",connectAPIEndPoint:"/tc/api/2.0",loginConnectTokenEndPoint:"/api/v1.0/users/connectToken",loginUsersEndPoint:"/api/v1.0/users",loginServer:"https://stg-login.sketchup.com",loginEndPoint:"/login/trimbleid",logoutEndPoint:"/logout",ADD_LOCATION_SERVICES:"/addlocation/services"}};a.GetProd=d});
define("FolderMetadata",["require","exports","ModelStorageProviderFactory"],function(n,a,l){Object.defineProperty(a,"__esModule",{value:!0});a.FolderMetadata=a.RemoteModelMetadata=void 0;n=function(){return function(a,f,h,g,m,c,b){this.fileId=a;this.projectId=f;this.parentFolderId=h;this.versionId=g;this.providerKey=m;this.region=c;this.isModified=b}}();a.RemoteModelMetadata=n;var k=function(){return function(a,f,h,g){void 0===a&&(a="");void 0===f&&(f=l.ProviderKey.Trimble_Connect);void 0===h&&(h=
"");void 0===g&&(g={});this.folderId=a;this.providerKey=f;this.region=h;this.filesMap=g}}();n=function(){function a(d){this.folderPath_=d;this.serializable_=new k}a.prototype.initFromJson=function(a){this.serializable_=JSON.parse(a);goog.isDefAndNotNull(this.serializable_.folderId)||(this.serializable_.folderId="");goog.isDefAndNotNull(this.serializable_.providerKey)||(this.serializable_.providerKey=l.ProviderKey.Trimble_Connect);goog.isDefAndNotNull(this.serializable_.region)||(a=Object.getOwnPropertyNames(this.serializable_.filesMap),
this.serializable_.region=0<a.length?this.serializable_.filesMap[a[0]].region:"");goog.isDefAndNotNull(this.serializable_.filesMap)||(this.serializable_.filesMap={})};a.prototype.addFile=function(a,d){this.serializable_.filesMap[a]=d};a.prototype.removeFile=function(a){delete this.serializable_.filesMap[a]};a.prototype.lookupFile=function(a){return this.serializable_.filesMap[a]};Object.defineProperty(a.prototype,"folderId",{get:function(){return this.serializable_.folderId},set:function(a){this.serializable_.folderId=
a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"providerKey",{get:function(){return this.serializable_.providerKey},set:function(a){this.serializable_.providerKey=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"region",{get:function(){return this.serializable_.region},set:function(a){this.serializable_.region=a},enumerable:!1,configurable:!0});a.prototype.write=function(){};a.hasMetadata=function(a){return!1};a.read=function(f){goog.string.path.join(f,a.METADATA_FILENAME);
return new a(f)};a.lookupRemoteModelMetadata=function(f){var h=goog.string.path.dirname(f);f=goog.string.path.baseName(f);return a.read(h).lookupFile(f)};a.METADATA_FILENAME=".metadata";return a}();a.FolderMetadata=n});
define("FileManager","require exports FolderMetadata ModelStorageProvider ModelStorageProviderFactory DateHelper".split(" "),function(n,a,l,k,d,f){Object.defineProperty(a,"__esModule",{value:!0});a.FileManager=void 0;n=function(){function a(){a.AUTOSAVE_PREFIX="autosave-";this.remoteFileMap_={};this.remoteProjectMap_={};this.folderPathFolderIdMap_={};this.trimbleConnect_=d.Providers[d.ProviderKey.Trimble_Connect]}a.prototype.addRemoteFiles=function(a){for(var d=0;d<a.length;++d){var c=a[d];this.remoteFileMap_[c.id]=
c}};a.prototype.addRemoteProjects=function(a){for(var d=0;d<a.length;d++){var c=a[d];this.remoteProjectMap_[c.rootFolderId]=c}};a.prototype.clearMaps=function(){this.remoteFileMap_={};this.remoteProjectMap_={}};a.prototype.getProjectCount=function(){return goog.object.getKeys(this.remoteProjectMap_).length};a.prototype.getFolderAncestorList=function(a){var d=[];do{var c=this.remoteFileMap_[a];if(!c)break;d.unshift({name:c.name,id:c.id,localPath:void 0});a=c.parentFolderId}while(a);c=this.remoteProjectMap_[a];
goog.isDefAndNotNull(c)&&d.unshift({name:c.name,id:a,localPath:void 0});return d};a.prototype.getFolderAncestorListFromPath=function(g){if(goog.string.startsWith(g,a.OFFLINE_DIR)){for(var d=[];g!==a.OFFLINE_DIR;){var c=goog.string.path.baseName(g);goog.string.isEmpty(c)||d.unshift({name:c,id:this.folderPathFolderIdMap_[g]||"",localPath:g});g=goog.string.path.dirname(g)}if(2<=d.length)d.shift(),d.shift();else throw"Not enough ancestors";return d}throw"Path must be in OFFLINE_DIR: "+g;};a.prototype.makeFolderPathFromAncestorList=
function(a){for(var d="",c=0;c<a.length;++c)d=goog.string.path.join(d,a[c].name);return d};a.prototype.makeFolderIdPathFromAncestorList=function(a){for(var d="",c=0;c<a.length;++c)d=goog.string.path.join(d,a[c].id);return d};a.prototype.createRemoteFolder=function(a,f,c,b){var e=this;return d.Providers[a].createFolder(f,c,b).then(function(a){e.addRemoteFiles([a]);return e.convertFolderItemToFileItemView(a)})};a.prototype.convertFolderItemToFileItemView=function(a){a={name:a.name,isFolder:a.type===
k.FolderItemType.Folder,thumbnailURL:a.thumbnailURL,isLocal:!1,versionState:k.FileVersionState.UpToDate,isActionInProgress:!1,remoteId:a.id,remoteVersionId:a.versionId,sizeInKB:a.size/1024,createdOn:f.convertTimeStamp(a.createdOn),modifiedOn:f.convertTimeStamp(a.modifiedOn),createdByEmail:a.createdByEmail,createdByFirstName:a.createdByFirstName,createdByLastName:a.createdByLastName,modifiedByEmail:a.modifiedByEmail,modifiedByFirstName:a.modifiedByFirstName,modifiedByLastName:a.modifiedByLastName};
a.isFolder&&!goog.isDef(a.thumbnailURL)&&(a.thumbnailURL=this.getDefaultFolderURL());return a};a.prototype.getFileViewsForFolder=function(a,d,c){var b=this,e=[];d=this.trimbleConnect_.getContents(d,c).then(function(d){b.addRemoteFiles(d);b.folderPathFolderIdMap_[a]=c;for(var p=0;p<d.length;++p){var t=b.convertFolderItemToFileItemView(d[p]);e.push(t)}return e});d=d.thenCatch(function(){});var f=this.readLocalFilesInFolder(a);return goog.Promise.all([d,f]).then(function(b){var p=b[0]||[],t=b[1],c=l.FolderMetadata.read(a);
b=p.filter(function(a){var b=goog.array.findIndex(t,function(b){return b.name===a.name});if(-1!==b){var b=t[b],p=b.isFolder?null:c.lookupFile(b.name);b.remoteId=a.remoteId;b.remoteVersionId=a.remoteVersionId;goog.isDefAndNotNull(p)?(b.localVersionId=p.versionId,b.localVersionId!==b.remoteVersionId?(b.versionState=k.FileVersionState.ModifiedAtRemoteStorage,p.isModified&&(b.versionState=k.FileVersionState.HasConflict)):p.isModified&&(b.versionState=k.FileVersionState.ModifiedLocally)):(b.localVersionId=
"",b.versionState=k.FileVersionState.UpToDate);b.createdByFirstName=a.createdByFirstName;b.createdByLastName=a.createdByLastName;b.createdByEmail=a.createdByEmail;b.modifiedByFirstName=a.modifiedByFirstName;b.modifiedByLastName=a.modifiedByLastName;b.modifiedByEmail=a.modifiedByEmail;b.createdOn=a.createdOn;b.modifiedOn=a.modifiedOn;return!1}return!0});t.forEach(function(a){goog.string.isEmptySafe(a.remoteId)&&(a.versionState=k.FileVersionState.ModifiedLocally)});b=b.concat(t);b.sort(function(a,b){return a.isFolder===
b.isFolder?a.name.localeCompare(b.name):a.isFolder?-1:1});return b})};a.prototype.readLocalFilesInFolder=function(a){return new goog.Promise(function(a,c){a([])})};a.prototype.makeFileViewForLocalDirectory=function(a){return{name:goog.string.path.basename(a),isFolder:!0,thumbnailURL:this.getDefaultFolderURL(),isLocal:!0,versionState:k.FileVersionState.UpToDate,isActionInProgress:!1,localPath:a,remoteId:"",sizeInKB:0,createdOn:"",modifiedOn:""}};a.prototype.getDefaultFolderURL=function(){return"images/tb_FolderOpen.svg"};
a.getInstance=function(){a.staticInstance_||(a.staticInstance_=new a);return a.staticInstance_};a.prototype.deleteFileOrFolder=function(a,f,c){var b=goog.Promise.resolve(!0);goog.string.isEmptySafe(a.remoteId)||(f=d.Providers[f],b=a.isFolder?f.deleteFolder(c,a.remoteId):f.deleteFile(c,a.remoteId));return b};a.SAVE_DIR="/autosave-indexeddb";a.OFFLINE_DIR=goog.string.path.join(a.SAVE_DIR,"offline");a.AUTOSAVE_SUBDIR=".autosave";a.DEFAULT_AUTOSAVE_DIR=goog.string.path.join(a.SAVE_DIR,a.AUTOSAVE_SUBDIR);
return a}();a.FileManager=n});
define("Init",["require","exports","l10n"],function(n,a,l){function k(a,f){function h(a,d){if(0<a.length){var c=a.shift();Array.isArray(c)||(c=[c]);n(c,function(){d.push.apply(d,arguments);h(a,d)})}else f.apply(null,d)}h(a,[])}Object.defineProperty(a,"__esModule",{value:!0});a.withModule=void 0;a.withModule=function(a){var f=[],h=l.getLanguageFilePath("js/l10n/");if(h){var g=l.getCurrentLanguage();f.push([h,"js/templates-"+g+".js"]);f.push("module-"+g)}else f.push("js/templates-en.js");f.push(a);
k(f,function(){})}});define("LoadingGif",["require","exports"],function(n,a){function l(a){if(!goog.isDefAndNotNull(d)){var h=goog.soy.renderAsFragment(SketchUpTemplates.loadingGif,{});a.appendChild(h);d=h}}function k(a){goog.isDefAndNotNull(d)&&d.parentElement===a&&d.parentElement.removeChild(d);d=null}Object.defineProperty(a,"__esModule",{value:!0});a.Toggle=a.Hide=a.Show=void 0;var d=null;a.Show=l;a.Hide=k;a.Toggle=function(a){goog.isDefAndNotNull(d)?k(a):l(a)}});
define("TextInput",["require","exports","SketchUpEvent"],function(n,a,l){Object.defineProperty(a,"__esModule",{value:!0});a.LabeledTextInput=a.EditField=void 0;a.EditField=function(a,d){void 0===d&&(d=!1);return new goog.Promise(function(f,h){var g=goog.dom.createDom("INPUT",{type:"text",value:a.textContent,"class":"scene-name-editable"});goog.dom.replaceNode(g,a);g.focus();d&&g.select();var m=!1,c=function(){m||(m=!0,a.textContent=g.value,goog.dom.replaceNode(a,g),f(g.value))};g.addEventListener("keydown",
function(b){var e=b.keyCode||b.which;e==goog.events.KeyCodes.ENTER?(b.stopPropagation(),c()):e==goog.events.KeyCodes.ESC&&(b.stopPropagation(),m=!0,goog.dom.replaceNode(a,g),h(null))});g.addEventListener("blur",function(a){c()})})};n=function(){function a(d,f){var h=this;this.changeEvent_=l.SketchUpEvents.Create();this.label_=d;this.initialValue_=f;var g=goog.soy.renderAsFragment(SketchUpTemplates.inputText,{title:d,initialValue:f});this.content_=g;var m=g.querySelector("input");m.addEventListener("keypress",
function(a){(a.keyCode||a.which)==goog.events.KeyCodes.ENTER&&h.fireTextChange(m.value)});m.addEventListener("blur",function(a){h.fireTextChange(m.value)})}a.prototype.addToContainer=function(a){a.appendChild(this.content_)};a.prototype.fireTextChange=function(a){this.changeEvent_.trigger(a)};Object.defineProperty(a.prototype,"onChange",{get:function(){return this.changeEvent_},enumerable:!1,configurable:!0});return a}();a.LabeledTextInput=n});
define("OpenDialogWidget","require exports DetailsView DialogPrompts FileManager FileUtils l10n LoadingGif ModelStorageProvider ModelStorageProviderFactory TextInput ErrorHandler".split(" "),function(n,a,l,k,d,f,h,g,m,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});a.OpenDialogWidget=a.LaunchMode=void 0;var r;(function(a){a[a.ModelOpen=0]="ModelOpen";a[a.ModelSave=1]="ModelSave";a[a.ImportReference=2]="ImportReference"})(r=a.LaunchMode||(a.LaunchMode={}));n=function(){function a(b,t){this.parent_=
b;this.feedback_=t;this.onSaveInputKeyDownHandler_=null;this.launchMode_=r.ModelOpen;this.trimbleConnect_=c.Providers[c.ProviderKey.Trimble_Connect];this.errorHandler_=new e.ErrorHandler;this.projectsRenderInProgress_=!1;this.render()}a.prototype.render=function(){var a=goog.soy.renderAsFragment(SketchUpTemplates.leftSidebarConnectTab,{});this.parent_.appendChild(a);this.container_=a;g.Show(this.container_);this.content_=a.querySelector(".trimble-connect-content");this.saveNewModelInputContainer_=
a.querySelector(".save-new-model-container");this.saveNewModelInput_=this.saveNewModelInputContainer_.querySelector(".save-new-model-input");this.saveNewModelButton_=this.saveNewModelInputContainer_.querySelector(".save-here-button");this.saveNewModelButton_.addEventListener("click",this.handleSave.bind(this))};Object.defineProperty(a.prototype,"currentRegionLocation",{get:function(){return goog.isDefAndNotNull(this.currentRegion_)?this.currentRegion_:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"currentFolderId",{get:function(){return goog.isDefAndNotNull(this.currentFolderId_)?this.currentFolderId_:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"currentProjectId",{get:function(){return goog.isDefAndNotNull(this.currentProjectId_)?this.currentProjectId_:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"currentModelId",{get:function(){return goog.isDefAndNotNull(this.currentModelId_)?this.currentModelId_:null},enumerable:!1,configurable:!0});
a.prototype.disableOpenButton=function(){this.disableButton(this.getOpenButton())};a.prototype.enableOpenButton=function(){this.enableButton(this.getOpenButton())};a.prototype.disablePublishButton=function(){this.disableButton(this.getPublishButton())};a.prototype.enablePublishButton=function(){this.enableButton(this.getPublishButton())};a.prototype.open=function(a){var b=this,c=a.mode,e=a.projectId,d=a.folderId,g=a.location,f=a.fileName;goog.isDefAndNotNull(a.fileId)&&(this.currentModelId_=a.fileId);
this.launchMode_=c;switch(this.launchMode_){case r.ModelSave:this.saveNewModelInputContainer_.classList.remove("invisible");this.setModelTitleInputFieldContents(f);break;case r.ModelOpen:this.saveNewModelInputContainer_.classList.add("invisible");this.detailsView_=new l.OpenDetailsView(this.container_,this.importFile.bind(this),this.openFolderOrFile.bind(this),null);break;case r.ImportReference:this.saveNewModelInputContainer_.classList.add("invisible");this.detailsView_=new l.ImportRefView(this.container_,
this.importFile.bind(this),this.openFolderOrFile.bind(this),null);break;default:console.log("Invalid Launch Mode passed to File Dialog")}this.adjustStyleForScrollableContent();this.makeVisible();a=this.trimbleConnect_.initialize(a);console.log("Initializing Trimble Connect");a=a.then(function(){goog.isDefAndNotNull(e)&&goog.isDefAndNotNull(d)?(b.currentFolderId_=d,b.currentProjectId_=e,b.getRegion(g).then(function(a){b.currentRegion_=a;b.renderFolderView(a,d)}).thenCatch(function(a){console.log("Caught error fetching region");
b.errorHandler_.rescue(a)})):b.renderProjectsView()});a.thenCatch(function(a){console.log("Failed to initialize Trimble Connect.");b.errorHandler_.rescue(a);b.renderProjectsView()});return new goog.Promise(function(a,b){},this)};a.prototype.updateProgressDialog=function(a){if(goog.isDefAndNotNull(this.progressDialog_))this.progressDialog_.onProgress(a)};a.prototype.processFileTransferError=function(a){a=Error(a);console.log("File Transfer Failed.");this.errorHandler_.rescue(a);this.progressDialog_.close()};
a.prototype.setupDownloadProgressDialog=function(){this.setupProgressDialog(h.$t("Downloading..."))};a.prototype.setupUploadProgressDialog=function(){this.setupProgressDialog(h.$t("Uploading..."))};a.prototype.setupImportProgressDialog=function(){this.setupProgressDialog(h.$t("Importing..."))};a.prototype.getRegion=function(a){return goog.isDefAndNotNull(a)?goog.Promise.resolve(a):this.trimbleConnect_.getRegionForProject(this.currentProjectId_)};a.prototype.makeVisible=function(){this.container_.classList.remove("left-sidebar-hidden")};
a.prototype.renderProjectsView=function(){var a=this;if(!this.projectsRenderInProgress_){this.projectsRenderInProgress_=!0;this.currentProjectId_=this.currentFolderId_=this.currentRegion_=null;goog.dom.removeChildren(this.content_);this.closeDetailsView();this.fileNameElementMap_={};this.enableSaveModelButtonIfVisible(!1);var b=goog.soy.renderAsFragment(SketchUpTemplates.projectsView,{});this.content_.appendChild(b);this.adjustStyleForScrollableContent();this.registerProjectsLinkClickHandler(b);g.Show(this.container_);
this.projectsList_=b.querySelector(".projects-section ul");var b=this.trimbleConnect_.getProjectsOrCreateDefault(),c=[],u=!1,f=d.FileManager.getInstance();f.clearMaps();for(var h=0;h<b.length;h++){var q=b[h].promise.then(this.handleProjectResponse.bind(this)).thenCatch(function(b){console.log("Error loading projects from region. "+b);u=u||a.errorHandler_.getCode(b)===e.code.UNAUTHORIZED_LICENSE});c.push(q)}goog.Promise.allSettled(c).thenAlways(function(){a.projectsRenderInProgress_=!1;0==f.getProjectCount()&&
u&&a.errorHandler_.handleErrorCode(e.code.UNAUTHORIZED_LICENSE)})}};a.prototype.handleProjectResponse=function(a){if(a.length){d.FileManager.getInstance().addRemoteProjects(a);for(var b=0;b<a.length;++b){var c=a[b];if("svg"==goog.string.path.extension(c.thumbnailURL))this.renderSingleProject(c);else var e=this.trimbleConnect_.downloadThumbnail(c.thumbnailURL),e=e.then(this.projectThumbnailDownloadDone.bind(this,c)),e=e.thenCatch(function(){})}}};a.prototype.reRenderCurrentFolderView=function(){goog.isDefAndNotNull(this.currentRegion_)&&
goog.isDefAndNotNull(this.currentFolderId_)&&this.renderFolderView(this.currentRegion_,this.currentFolderId_,this.currentFolderPath_)};a.prototype.adjustStyleForScrollableContent=function(){var a=this.content_.querySelector(".connect-scrollable-content");a&&(this.launchMode_===r.ModelSave?a.classList.add("connect-scrollable-content-short"):a.classList.remove("connect-scrollable-content-short"))};a.prototype.registerProjectsLinkClickHandler=function(a){a.querySelector(".projects-link").addEventListener("click",
this.renderProjectsView.bind(this))};a.prototype.closeDetailsView=function(){this.detailsView_&&this.detailsView_.close()};a.prototype.renderSingleProject=function(a){a=goog.soy.renderAsFragment(SketchUpTemplates.projectInstance,{project:a});a.addEventListener("click",this.handleProjectClick.bind(this,a));g.Hide(this.container_);this.projectsList_.appendChild(a)};a.prototype.projectThumbnailDownloadDone=function(a,b){a.thumbnailData=f.ArrayBufferToBase64(b);this.renderSingleProject(a)};a.prototype.handleProjectClick=
function(a,b){var c=a.dataset.projectregion,e=a.dataset.projectfolder,d=a.dataset.projectid;this.currentRegion_=c;this.currentProjectId_=d;this.renderFolderView(c,e)};a.prototype.renderFolderView=function(a,b,c){var e=this;goog.dom.removeChildren(this.content_);this.closeDetailsView();this.fileNameElementMap_={};this.currentFolderFileItemViews_=null;this.enableSaveModelButtonIfVisible(!1);var f=d.FileManager.getInstance(),h={ancestorList:void 0},q,m;if(goog.string.isEmptyString(b)){if(goog.string.isEmptySafe(c))throw"No folder id or local folder path";
h.ancestorList=f.getFolderAncestorListFromPath(c);q=c}else m=this.getFolderAncestorListNoCache(b,this.currentRegion_),m.then(function(c){h.ancestorList=c;q=f.makeFolderPathFromAncestorList(h.ancestorList);e.currentFolderId_=b;e.currentFolderPath_=q;c=goog.soy.renderAsFragment(SketchUpTemplates.projectFileView,h);e.registerProjectsLinkClickHandler(c);e.setupBreadcrumbs(c,h);e.fileContainer_=c.querySelector(".file-tree ul");e.setupActionsBar(c);e.content_.appendChild(c);e.adjustStyleForScrollableContent();
c=e.getCurrentFolderFullPath();g.Show(e.container_);return f.getFileViewsForFolder(c,a,b)}).then(function(a){e.currentFolderFileItemViews_=a;e.enableSaveModelButtonIfVisible(!0);g.Hide(e.container_);e.renderFileTree(a)});return m};a.prototype.setupBreadcrumbs=function(a,b){var c=a.querySelectorAll(".folder-link");if(c.length!==b.ancestorList.length)throw"Mismatching breadcrumb sizes";for(var e=0;e<c.length;++e){var d=c[e],g=b.ancestorList[e];d.addEventListener("click",function(a){this.renderFolderView(this.currentRegion_,
a,g.localPath)}.bind(this,d.dataset.folderid))}};a.prototype.setupActionsBar=function(a){var b=a.querySelector(".add-file-button"),c=a.querySelector(".add-folder-button");a=a.querySelector(".sync-button");c.addEventListener("click",this.onAddFolder.bind(this));this.launchMode_===r.ModelSave?(b.classList.add("disabled-button"),a.classList.add("disabled-button")):(b.classList.remove("disabled-button"),a.classList.remove("disabled-button"),b.addEventListener("click",this.onAddFile.bind(this)))};a.prototype.renderFileTree=
function(a){for(var b=0;b<a.length;++b)this.renderSingleFileOrFolder(a[b]);0==a.length&&this.notifyEmptyFolder()};a.prototype.renderSingleFileOrFolder=function(a,b,c){var e=this;void 0===b&&(b=!0);void 0===c&&(c=!1);var d=a.versionState===m.FileVersionState.HasConflict,g=goog.soy.renderAsFragment(SketchUpTemplates.fileEntry,{fileEntry:a,hasConflict:d,isFolder:a.isFolder});g.addEventListener("click",this.selectFile.bind(this,a,g));g.addEventListener("dblclick",this.openFolderOrFile.bind(this,a));a.isFolder&&
goog.dom.getElementByClass("connect-foldername",g).addEventListener("click",function(b){b.stopPropagation();e.openFolderOrFile(a)});if(this.launchMode_!==r.ModelSave&&a.versionState!==m.FileVersionState.UpToDate){var f=goog.dom.getElementByClass("file-sync-actions-div",g);f.classList.remove("invisible");var h=a.versionState===m.FileVersionState.ModifiedAtRemoteStorage||a.versionState===m.FileVersionState.HasConflict;this.showDownloadUploadButton(a,f,"download-cloud",!0,h,d);h=a.versionState===m.FileVersionState.ModifiedLocally||
a.versionState===m.FileVersionState.HasConflict;this.showDownloadUploadButton(a,f,"upload-cloud",!1,h,d)}goog.dom.getElementByClass("close-button",g).addEventListener("click",this.onClickDeleteButton.bind(this,a));b?this.fileContainer_.appendChild(g):this.fileContainer_.insertBefore(g,this.fileContainer_.firstChild);c||(this.fileNameElementMap_[a.name]=g);return g};a.prototype.getCurrentFolderFullPath=function(){return"/"};a.prototype.onAddFolder=function(a){var e=this,g=d.FileManager.getInstance();
a=this.createUniqueFilename(h.$t("New Folder"));this.removeEmptyFolderMessage();a=g.makeFileViewForLocalDirectory(a);a.isActionInProgress=!0;var f=this.renderSingleFileOrFolder(a,!1,!0);a=goog.dom.getElementByClass("connect-foldername",f);a=b.EditField(a,!0).then(function(a){if(e.isFileNameAvailable(a))return g.createRemoteFolder(c.ProviderKey.Trimble_Connect,e.currentRegion_,a,e.currentFolderId_);window.setTimeout(function(){k.ShowInfoDialog(h.$t("Error"),h.$t("A file or folder with same name already exists."))},
0);return goog.Promise.reject(null)});a=a.then(function(a){var b=e.renderSingleFileOrFolder(a,!1);e.fileContainer_.replaceChild(b,f);e.selectFile(a,b)});a=a.thenCatch(function(a){e.fileContainer_.removeChild(f);goog.isDefAndNotNull(a)&&k.ShowInfoDialog(h.$t("Error"),h.$t("Sorry, this folder could not be created.")).then(function(){e.errorHandler_.rescue(a)})})};a.prototype.onAddFile=function(a){this.deselectSelected();this.detailsView_.makeVisible();this.detailsView_.activateImportPage()};a.prototype.deselectSelected=
function(){this.selectedFile_&&this.selectedFile_.classList.remove("selected-file");this.selectedFile_=null};a.prototype.selectFile=function(a,b){a.isActionInProgress||(this.deselectSelected(),this.selectedFile_=b,this.selectedFile_.classList.add("selected-file"),this.launchMode_===r.ModelSave?a.isFolder||this.setModelTitleInputFieldContents(a.name):this.detailsView_.activateFileDetails(a))};a.prototype.createUniqueFilename=function(a){for(var b=a,c=0;!this.isFileNameAvailable(b);)b=a+(++c).toString();
return b};a.prototype.isFileNameAvailable=function(a){for(var b in this.fileNameElementMap_)if(0===goog.string.caseInsensitiveCompare(b,a))return!1;return!0};a.prototype.showDownloadUploadButton=function(a,b,c,e,d,g){b=goog.dom.getElementByClass(c,b);d?e?b.addEventListener("click",this.onClickDownloadButton.bind(this,a,g)):b.addEventListener("click",this.onClickUploadButton.bind(this,a)):b.classList.add("invisible")};a.prototype.onClickDeleteButton=function(a,b){b.stopPropagation();a.isActionInProgress=
!0;this.feedback_.deleteFile(a)};a.prototype.doDeleteFileItem=function(a){var b=this,e=d.FileManager.getInstance().deleteFileOrFolder(a,c.ProviderKey.Trimble_Connect,this.currentRegion_),e=e.then(function(c){c&&b.reRenderCurrentFolderView();a.isActionInProgress=!1;return c});e.thenCatch(function(a){console.log("Failed to delete the File Item.");b.errorHandler_.rescue(a)})};a.prototype.onClickDownloadButton=function(a,b,c){};a.prototype.onClickUploadButton=function(a,b){};a.prototype.importFile=function(a){};
a.prototype.importReferenceFile=function(a){a.isActionInProgress||(a.isFolder?this.renderFolderView(this.currentRegion_,a.remoteId,a.localPath):this.launchMode_!==r.ModelSave&&this.feedback_.importReferenceFile(a))};a.prototype.openFolderOrFile=function(a){a.isActionInProgress||(a.isFolder?this.renderFolderView(this.currentRegion_,a.remoteId,a.localPath):this.launchMode_===r.ModelOpen?this.feedback_.openFile(a):this.launchMode_===r.ImportReference&&this.feedback_.importReferenceFile(a))};a.prototype.setupProgressDialog=
function(a){this.progressDialog_=k.ShowProgressDialog(a);this.progressDialog_.setCancelCallback(this.feedback_.cancelFileTransfer)};a.prototype.getFolderAncestorListNoCache=function(a,b){var c=this;return new goog.Promise(function(e,d){c.getFolderAncestorListRecursive(a,b,[],e)})};a.prototype.getFolderAncestorListRecursive=function(a,b,c,e){var d=this;a=this.trimbleConnect_.getFolderDetails(b,a);a.then(function(a){c.unshift({name:a.name,id:a.id,localPath:void 0});a.parentFolderId?d.getFolderAncestorListRecursive(a.parentFolderId,
b,c,e):e(c)});a.thenCatch(function(a){d.handleInvalidSavedState(a)})};a.prototype.setModelTitleInputFieldContents=function(a){this.saveNewModelInput_.value=a;this.saveNewModelInput_.focus();this.saveNewModelInput_.select()};a.prototype.enableSaveModelButtonIfVisible=function(a){var b=this;this.launchMode_===r.ModelSave&&(a?(this.saveNewModelButton_.classList.remove("disabled-button"),goog.isNull(this.onSaveInputKeyDownHandler_)&&(this.onSaveInputKeyDownHandler_=function(a){(a.keyCode||a.which)===
goog.events.KeyCodes.ENTER&&(a.stopPropagation(),a.preventDefault(),b.handleSave())},this.saveNewModelInput_.addEventListener("keydown",this.onSaveInputKeyDownHandler_))):(this.saveNewModelButton_.classList.add("disabled-button"),goog.isNull(this.onSaveInputKeyDownHandler_)||(this.saveNewModelInput_.removeEventListener("keydown",this.onSaveInputKeyDownHandler_),this.onSaveInputKeyDownHandler_=null)))};a.prototype.handleSave=function(){var a=this;if(goog.isDefAndNotNull(this.currentFolderId_)&&goog.isDefAndNotNull(this.currentFolderFileItemViews_)){var b=
this.saveNewModelInput_.value;if(0!==b.length){for(var c,e=f.StripExtension(b),d=0,g=this.currentFolderFileItemViews_;d<g.length;d++){var q=g[d],m=f.StripExtension(q.name);if(0==goog.string.caseInsensitiveCompare(e,m)){c=q;break}}e=goog.Promise.resolve(!0);goog.isDefAndNotNull(c)&&(e=k.ShowQuestionDialog(h.$t("A model with the same name already exists.")+"\n"+h.$t("Overwrite it?")));e=e.then(function(c){c&&a.feedback_.publishFile(a.currentFolderId_,b);return!0});e.thenCatch(function(b){console.log("Failed to initiate the file publish operation.");
a.errorHandler_.rescue(b)})}}};a.prototype.handleInvalidSavedState=function(a){var b=this;console.log("Failed to Load Saved Dialog State.");this.currentProjectId_=this.currentFolderId_=this.currentRegion_=null;console.log(a.message);this.trimbleConnect_.refreshToken().then(function(){b.renderProjectsView()})};a.prototype.notifyEmptyFolder=function(){var a=h.$t("This folder is empty"),a=goog.soy.renderAsFragment(SketchUpTemplates.emptyList,{message:a});document.querySelector(".file-tree ul").appendChild(a)};
a.prototype.removeEmptyFolderMessage=function(){var a=document.querySelector(".empty-list-message"),b=document.querySelector(".file-tree ul");goog.isDefAndNotNull(a)&&b.removeChild(a)};a.prototype.getOpenButton=function(){return goog.dom.getElementByClass("bottom-button")};a.prototype.getPublishButton=function(){return goog.dom.getElementByClass("save-here-button")};a.prototype.disableButton=function(a){a.classList.add("disabled-button")};a.prototype.enableButton=function(a){a.classList.remove("disabled-button")};
return a}();a.OpenDialogWidget=n});define("SketchUpFileRequest",["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0})});
define("ProgressDialog","require exports ModelStorageProviderFactory DialogPrompts l10n ErrorHandler".split(" "),function(n,a,l,k,d,f){Object.defineProperty(a,"__esModule",{value:!0});a.UploadProgressDialog=void 0;n=function(){function a(d){this.parent_=d;this.trimbleConnect_=l.Providers[l.ProviderKey.Trimble_Connect];this.errorHandler_=new f.ErrorHandler;this.render()}a.prototype.render=function(){var a=d.$t("Uploading...");this.progressDialog_=k.ShowProgressDialog(a);this.progressDialog_.setCancelCallback(this.cancelFileTransfer);
a=goog.dom.getElementByClass("modal-dialog");a.style.width="100%";a.style.height="100%";a.style.left="0px";a.style.top="0px";a.style.boxSizing="border-box";goog.dom.getElementByClass("progress-dialog-div").style.width="100%"};a.prototype.open=function(a){var d=this;this.trimbleConnect_.initialize(a).then(function(){d.sendUploadRequest(a)})};a.prototype.sendUploadRequest=function(a){var d=this,c=a.fileId;this.currentProjectId_=a.projectId;var b=a.location,e=null,f=null,q;this.getRegion(b).then(function(a){b=
a;return q=goog.isDefAndNotNull(c)?d.trimbleConnect_.getFileDetails(b,c):goog.Promise.resolve(null)}).then(function(a){a&&(e=a.versionId,f=a.name)}).then(function(){var p={token:d.trimbleConnect_.token,baseURL:d.trimbleConnect_.baseURL(b),fileName:a.fileName,projectId:a.projectId,parentId:a.folderId,location:b,remoteIdPath:a.remoteIdPath,versionId:e,fileId:c,remoteFileName:f};window.sketchup.publish_file(JSON.stringify(p))}).thenCatch(function(a){d.errorHandler_.rescue(a)})};a.prototype.updateProgress=
function(a){if(goog.isDefAndNotNull(this.progressDialog_))this.progressDialog_.onProgress(a)};a.prototype.processFileTransferError=function(a){a=this.errorHandler_.getCode(Error(a));this.errorHandler_.handleErrorCode(a,f.ErrorContext.FileUpload)};a.prototype.cancelFileTransfer=function(){window.sketchup.cancel_file_transfer()};a.prototype.getRegion=function(a){return goog.isDefAndNotNull(a)?goog.Promise.resolve(a):this.trimbleConnect_.getRegionForProject(this.currentProjectId_)};return a}();a.UploadProgressDialog=
n});
define("TaskDialogWidget","require exports DialogPrompts ModelStorageProviderFactory LoadingGif DateHelper FileUtils l10n TC-Object ReferenceListView ErrorHandler".split(" "),function(n,a,l,k,d,f,h,g,m,c,b){Object.defineProperty(a,"__esModule",{value:!0});a.TaskDlg=a.TaskDialogWidget=a.TabView=void 0;var e;(function(a){a[a.TaskList=0]="TaskList";a[a.TaskConsume=1]="TaskConsume";a[a.Comment=2]="Comment";a[a.Reference=3]="Reference"})(e=a.TabView||(a.TabView={}));n=function(){function a(c,e){this.parent_=c;
this.feedback_=e;this.initialized_=!1;this.MAX_ASSIGNEES=10;this.trimbleConnect_=k.Providers[k.ProviderKey.Trimble_Connect];this.setupDialog();this.currentRegion_=null;this.errorHandler_=new b.ErrorHandler}Object.defineProperty(a.prototype,"currentRegionLocation",{get:function(){return this.currentRegion_},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"currentModelId",{get:function(){return goog.isDefAndNotNull(this.currentModelId_)?this.currentModelId_:null},enumerable:!1,configurable:!0});
a.prototype.setupDialog=function(){this.container_=goog.soy.renderAsFragment(SketchUpTemplates.taskTab,{});this.parent_.appendChild(this.container_);console.log("Setting up Dialog");d.Show(this.container_)};a.prototype.render=function(){var a=goog.soy.renderAsFragment(SketchUpTemplates.topActionsBar,{});this.handleActionBarEvents(a);var b=goog.soy.renderAsFragment(SketchUpTemplates.taskContent,{});this.container_.appendChild(a);this.container_.appendChild(b);this.content_=this.container_.querySelector(".tasks-content-wrapper")};
a.prototype.handleActionBarEvents=function(a){var b=this,c=a.querySelector(".task-button");c.addEventListener("click",this.openTab.bind(this,e.TaskList));a.querySelector(".connect-button").addEventListener("click",this.openConnect.bind(this));var d=a.querySelector(".comments-button");d.addEventListener("click",this.openTab.bind(this,e.Comment));a=a.querySelector(".references-button");a.addEventListener("click",this.openTab.bind(this,e.Reference));[c,d,a].forEach(function(a,c,p){a.addEventListener("click",
b.displayAsSelected.bind(b,p,a))})};a.prototype.displayAsSelected=function(a,b){a.forEach(function(a,b,c){a.classList.remove("selected")});b.classList.add("selected")};a.prototype.open=function(a){var b=this,c=a.mode,e=a.projectId,g=a.location,f=a.fileId;this.currentUserEmail_=a.email;a=this.trimbleConnect_.initialize(a);console.log("Initializing Trimble Connect");a=a.then(function(){if(goog.isDefAndNotNull(e)&&goog.isDefAndNotNull(f))b.currentProjectId_=e,b.currentModelId_=f,b.getRegion(g).then(function(a){b.currentRegion_=
a;d.Hide(b.container_);b.render();b.openTab(c)}).thenCatch(function(a){console.log("Caught error fetching region");b.errorHandler_.rescue(a)});else throw Error("PROJECT_NOT_DEFINED");});a.thenCatch(function(a){console.log("Caught Error in Open");b.errorHandler_.rescue(a)});return new goog.Promise(function(a,b){},this)};a.prototype.getRegion=function(a){return goog.isDefAndNotNull(a)?goog.Promise.resolve(a):this.trimbleConnect_.getRegionForProject(this.currentProjectId_)};a.prototype.getUsers=function(){var a=
this;if(goog.isDefAndNotNull(this.currentUsers_))return goog.Promise.resolve();var b=this.trimbleConnect_.getUsers(this.currentRegion_,this.currentProjectId_);return b=b.then(function(b){var c=[];b.forEach(function(a,b,e){a.status==m.UserStatus.ACTIVE&&c.push(new m.User(a))});return a.currentUsers_=c})};a.prototype.getGroups=function(){var a=this;if(goog.isDefAndNotNull(this.currentGroups_))return goog.Promise.resolve();var b=this.trimbleConnect_.getUserGroups(this.currentRegion_,this.currentProjectId_);
return b=b.then(function(b){return a.currentGroups_=b})};a.prototype.openTab=function(a){if(this.currentTabView_!=a)switch(this.currentTabView_=a,d.Hide(this.commentList_),d.Hide(this.taskList_),a){case e.TaskList:this.renderTaskListView();break;case e.Comment:this.renderCommentsView();break;case e.Reference:this.renderReferencesView();break;default:this.renderTaskListView()}};a.prototype.renderTaskListView=function(){var a=this;this.clearContent();var c=goog.soy.renderAsFragment(SketchUpTemplates.tasksList,
{});this.content_.appendChild(c);var g=goog.soy.renderAsFragment(SketchUpTemplates.list,{}),f=goog.dom.getElementByClass("task-list-container");this.renderFilterView(f);c.appendChild(g);this.taskList_=g;this.renderTaskListActionBar();d.Hide(this.taskList_);d.Show(this.taskList_);this.getUsers().then(function(){return a.getGroups()}).then(function(){return a.trimbleConnect_.getTasks(a.currentRegion_,a.currentProjectId_)}).then(function(c){if(a.currentTabView_==e.TaskList)return a.getAttachments(c);
d.Hide(a.taskList_);return goog.Promise.reject(Error(b.code.ACTION_ABORTED_BY_USER))}).then(function(b){return a.getTaskViews(b)}).then(function(b){a.currentModelTasks_=a.getModelTasks(b);a.renderTaskList(a.currentModelTasks_)}).thenCatch(function(b){console.log("Caught error in renderTaskListView");a.errorHandler_.rescue(b);d.Hide(a.taskList_);d.Hide(a.commentList_)})};a.prototype.renderFilterView=function(a){var b=goog.soy.renderAsFragment(SketchUpTemplates.taskFilterView,{users:[],selectedUser:"",
priority:m.Task.priorityOptions[0],status:m.Task.statusOptions[0]});a.appendChild(b)};a.prototype.getAttachments=function(a){var b=this,c=[];a.forEach(function(a,e,p){c.push(b.trimbleConnect_.getTaskAttachments(b.currentRegion_,b.currentProjectId_,a.id))});var e=goog.Promise.all(c);return e=e.then(function(b){b.forEach(function(b,c,e){a[c].attachments=b});return a})};a.prototype.getTaskViews=function(a){var b=this,c=[];a.forEach(function(a){(a=a.getViewAttachment())?c.push(b.trimbleConnect_.getViewDetails(b.currentRegion_,
a.id)):c.push(goog.Promise.resolve(null))});var e=goog.Promise.all(c);return e=e.then(function(b){b.forEach(function(b,c){a[c].view=b});return a})};a.prototype.renderTaskListActionBar=function(){var a=goog.soy.renderAsFragment(SketchUpTemplates.taskActionsBar,{});this.content_.appendChild(a);a.querySelector(".create-task-button").addEventListener("click",this.renderCreateTaskView.bind(this));a.querySelector(".task-delete-button").addEventListener("click",this.deleteTask.bind(this))};a.prototype.getModelTasks=
function(a){var b=this,c=[];a.forEach(function(a){a.includesModel(b.currentModelId_)&&c.push(a)});return c};a.prototype.renderTaskList=function(a){a=this.sortTaskList(a);d.Hide(this.taskList_);if(this.currentTabView_==e.TaskList){goog.dom.removeChildren(this.taskList_);for(var b=0;b<a.length;++b)this.renderSingleTask(a[b]);0==a.length&&this.notifyEmptyTaskList();this.deselectAllTasks()}};a.prototype.sortTaskList=function(a){var b=a.filter(function(a){return a.status==m.TaskStatus[m.TaskStatus.CLOSED]}),
c=a.filter(function(a){return a.status==m.TaskStatus[m.TaskStatus.RESOLVED]}),e=a.filter(function(a){return a.status!=m.TaskStatus[m.TaskStatus.CLOSED]&&a.status!=m.TaskStatus[m.TaskStatus.RESOLVED]});a=e.filter(function(a){return!goog.isString(a.dueDate)});e=e.filter(function(a){return goog.isString(a.dueDate)});b.sort(function(a,b){return f.compareDateStrings(b.createdOn,a.createdOn)});c.sort(function(a,b){return f.compareDateStrings(b.createdOn,a.createdOn)});a.sort(function(a,b){return m.TaskPriority[a.priority]-
m.TaskPriority[b.priority]});e.sort(function(a,b){return f.compareDateStrings(a.dueDate,b.dueDate)});return e.concat(a,c,b)};a.prototype.renderSingleTask=function(a){var b=a.getDisplayedAssignee(),b={task:a,thumbnail:b.getThumbnail(),initials:b.getInitials()},b=goog.soy.renderAsFragment(SketchUpTemplates.taskEntry,b);b.addEventListener("dblclick",this.openTask.bind(this,b));b.addEventListener("click",this.selectTask.bind(this,a,b));this.taskList_.appendChild(b)};a.prototype.notifyEmptyTaskList=function(){var a=
g.$t("There are no ToDos related to this model.");this.taskList_.appendChild(goog.soy.renderAsFragment(SketchUpTemplates.emptyList,{message:a}))};a.prototype.getAssigneeDetailsAndThumbnail=function(a){var b=this,c;c=a.getDisplayedAssignee();c.hasDetails?a=goog.Promise.resolve(c):(a=this.trimbleConnect_.getUserDetails(this.currentRegion_,c.id),a=a.then(function(a){c=new m.User(a);c.hasThumbnail()&&(a=c.getThumbnailUrl(),a=b.trimbleConnect_.downloadThumbnail(a),a=a.then(function(a){c.setThumbnailData(a);
return a}));return c}));return a};a.prototype.renderCreateTaskView=function(){this.currentView_=null;this.clearContent();var a={mode:"CREATE",task:m.Task.defaultTask(this.currentProjectId_)};this.renderTaskDetailView(a);this.renderCaptureViewButton();a={cancelText:g.$t("Cancel"),cancelTooltip:g.$t("Cancel the ToDo creation"),commitText:g.$t("Create"),commitTooltip:g.$t("Publish this ToDo")};a=goog.soy.renderAsFragment(SketchUpTemplates.commitOrCancel,a);r.handleCommitOrCancelClick(a,this.publishTask.bind(this),
this.openTab.bind(this,e.TaskList));this.content_.appendChild(a);this.showUpdateTaskButton()};a.prototype.renderCaptureViewButton=function(){var a=goog.soy.renderAsFragment(SketchUpTemplates.captureView,{});a.addEventListener("click",this.getSUView.bind(this));document.querySelector(".task-view-image-container").appendChild(a)};a.prototype.renderEditTaskView=function(a){var b=this.renderTaskDetailView({mode:"EDIT",task:a});this.renderTaskCommentView(b);this.setRemoteTaskImage(a);b={cancelText:g.$t("Cancel"),
cancelTooltip:g.$t("Cancel changes to this ToDo"),commitText:g.$t("Update"),commitTooltip:g.$t("Publish changes to this ToDo")};b=goog.soy.renderAsFragment(SketchUpTemplates.commitOrCancel,b);r.handleCommitOrCancelClick(b,this.updateTask.bind(this,a),this.openTab.bind(this,e.TaskList));this.content_.appendChild(b);this.handleTaskEditEvents()};a.prototype.handleTaskEditEvents=function(){for(var a=this.content_.querySelectorAll(".task-input"),b=this.content_.querySelector(".capture-view-button"),c=
0;c<a.length;++c)a[c].addEventListener("change",this.showUpdateTaskButton.bind(this));for(c=0;c<a.length;++c)a[c].addEventListener("keyup",this.showUpdateTaskButton.bind(this));goog.isDefAndNotNull(b)&&b.addEventListener("click",this.showUpdateTaskButton.bind(this))};a.prototype.getRefreshViewButton=function(){return this.content_.querySelector(".task-view-image-refresh-button")};a.prototype.showUpdateTaskButton=function(){this.content_.querySelector(".commit-cancel-container").classList.add("visible");
this.content_.querySelector(".task-details").classList.add("compressed")};a.prototype.openConnect=function(){this.feedback_.openTrimbleConnect()};a.prototype.renderCommentsView=function(){var a=this;this.clearContent();var b=goog.soy.renderAsFragment(SketchUpTemplates.commentList,{}),c=g.$t("Comment on this model..."),c=goog.soy.renderAsFragment(SketchUpTemplates.commentInputBar,{placeholder:c});this.commentList_=b.querySelector(".comment-list-container ul");this.content_.appendChild(b);this.content_.appendChild(c);
d.Hide(this.commentList_);d.Show(this.commentList_);this.getUsers().then(function(){return a.trimbleConnect_.getComments(a.currentRegion_,a.currentModelId_,m.Type.file)}).then(function(b){a.comments_=b;d.Hide(a.commentList_);a.renderComments(a.comments_.reverse())}).thenCatch(function(b){console.log("Caught error in render Comments View");a.errorHandler_.rescue(b);d.Hide(a.taskList_);d.Hide(a.commentList_)});this.handlePublishCommentClick(this.publishComment)};a.prototype.renderComments=function(a){if(this.currentTabView_==
e.Comment){for(var b=0;b<a.length;++b)this.renderSingleComment(a[b]);0==a.length&&this.notifyEmptyCommentList()}};a.prototype.renderSingleComment=function(a){var b=this.getUserFromEmail(this.currentUserEmail_),c=new m.User(a.createdBy);a=a.createdBy.email==b.email?this.makeCommentHTMLElement(a,b,SketchUpTemplates.activeUserComment):this.makeCommentHTMLElement(a,c,SketchUpTemplates.userComment);this.commentList_.appendChild(a)};a.prototype.notifyEmptyCommentList=function(){var a=g.$t("There are no comments for this model.");
this.commentList_.appendChild(goog.soy.renderAsFragment(SketchUpTemplates.emptyList,{message:a}))};a.prototype.handlePublishCommentClick=function(a){goog.dom.getElementByClass("publish-comment").addEventListener("click",a.bind(this))};a.prototype.getUserFromEmail=function(a){for(var b=0;b<this.currentUsers_.length;++b)if(this.currentUsers_[b].email==a)return new m.User(this.currentUsers_[b]);return null};a.prototype.makeCommentHTMLElement=function(a,b,c){a={comment:a,user:b,thumbnail:b.getThumbnail(),
initials:b.getInitials(),date:f.convertTimeStamp(a.modifiedOn)};return goog.soy.renderAsFragment(c,a)};a.prototype.publishComment=function(){var a=this,b={},c=goog.dom.getElementByClass("comment-input-field"),e=c.value;if(!goog.string.isEmpty(e))return b.objectId=this.currentModelId_,b.objectType=m.Type.file,b.description=e,b=this.trimbleConnect_.publishComment(this.currentRegion_,b),b.then(function(b){c.value="";a.comments_.unshift(b);1==a.comments_.length?a.renderCommentsView():a.renderSingleComment(b)}),
b.thenCatch(function(b){a.errorHandler_.rescue(b)}),b};a.prototype.renderReferencesView=function(){this.feedback_.renderReferencesView()};a.prototype.renderReferencesViewCallback=function(a){var d=this;this.referencesView_=new c.ReferenceListView(this.content_,a,this.feedback_);for(var g=function(){var c=a[h].id;f.trimbleConnect_.getFileDetails(f.currentRegion_,c).then(function(a){var b=d.getAlignment(a.id);b.then(function(b){d.currentTabView_==e.Reference&&(a.alignment=b,d.referencesView_.addRemoteReference(a),
d.setReferenceModelImage(a),d.referencesView_.refreshFileStatus(c))});b.thenCatch(function(a){d.errorHandler_.rescue(a)})}).thenCatch(function(a){d.errorHandler_.getCode(a)==b.code.INVALID_OPERATION_FILE_DELETED&&d.currentTabView_==e.Reference?d.referencesView_.refreshFileStatus(c):d.errorHandler_.rescue(a)})},f=this,h=0;h<a.length;++h)g();this.clearContent();this.referencesView_.render()};a.prototype.updateReferenceStatus=function(a){goog.isDefAndNotNull(this.referencesView_)&&this.currentTabView_==
e.Reference&&(this.referencesView_.updateLocalReference(a),this.referencesView_.refreshFileStatus(a.id))};a.prototype.publishAlignment=function(a,b){var c=this;goog.isDefAndNotNull(this.referencesView_)&&this.trimbleConnect_.publishAlignment(this.currentRegion_,a,b).then(function(b){c.referencesView_.syncAlignment(a,b)}).then(function(){c.enableButton(c.getCommitButton());var a=g.$t("Alignment successfully published to Trimble Connect");l.ShowInfoDialog(g.$t("Info"),a)}).thenCatch(function(a){c.errorHandler_.rescue(a);
c.enableButton(c.getCommitButton())})};a.prototype.updateProgress=function(a,b){goog.isDefAndNotNull(this.referencesView_)&&this.referencesView_.updateProgress(a,b)};a.prototype.setReferenceModelImage=function(a){var b=this,c=a.thumbnailUrl;goog.isDefAndNotNull(c)&&(c=this.trimbleConnect_.downloadThumbnail(c[0]),c=c.then(this.referenceModelThumbnailDownloadDone.bind(this,a)),c=c.thenCatch(function(a){b.errorHandler_.rescue(a)}))};a.prototype.loadAlignment=function(a,b,c){this.referencesView_.loadAlignmentView(a,
b,c)};a.prototype.renderTaskDetailView=function(a){this.currentTabView_=e.TaskConsume;a=goog.soy.renderAsFragment(SketchUpTemplates.taskDetails,a);this.taskViewModified_=!1;this.content_.appendChild(a);this.setupAssignField();this.handleRefreshViewButtonEvents();return a};a.prototype.renderTaskCommentView=function(a){var b=g.$t("Add comment..."),b=goog.soy.renderAsFragment(SketchUpTemplates.taskCommentList,{placeholder:b});goog.dom.getElementByClass("task-details",a).appendChild(b);return b};a.prototype.setupAssignField=
function(){var a=goog.dom.getElementByClass("assign-task-input",this.content_),b=this.getUserFullNameIdMap(),c=this.getGroupNameIdMap(),e=[],d;for(d in b)e.push(b[d]);for(d in c)e.push(c[d]);goog.ui.ac.createSimpleAutoComplete(e,a,!0)};a.prototype.handleRefreshViewButtonEvents=function(){this.getRefreshViewButton().addEventListener("click",this.getSUView.bind(this));this.getRefreshViewButton().addEventListener("click",this.showUpdateTaskButton.bind(this))};a.prototype.getUserFullNameIdMap=function(){for(var a=
{},b=0;b<this.currentUsers_.length;b++){var c=this.currentUsers_[b].displayName();a[this.currentUsers_[b].id]=c}return a};a.prototype.getGroupNameIdMap=function(){for(var a={},b=0;b<this.currentGroups_.length;b++)a[this.currentGroups_[b].id]=this.currentGroups_[b].name;return a};a.prototype.getSUView=function(){var a=this;this.getAlignment(this.currentModelId).then(function(b){a.taskViewModified_=!0;a.feedback_.captureView(b)}).thenCatch(function(b){a.errorHandler_.rescue(b)})};a.prototype.getAlignment=
function(a){return this.trimbleConnect_.getAlignment(this.currentRegion_,a)};a.prototype.setRemoteTaskImage=function(a){var b=this,c=a.getThumbnailURL();if(goog.isDefAndNotNull(c)){var e=this.content_.querySelector(".task-view-image-container");d.Show(e);c=this.trimbleConnect_.downloadThumbnail(c);c=c.then(this.taskThumbnailDownloadDone.bind(this,a,e));c=c.thenCatch(function(a){b.errorHandler_.rescue(a)})}else this.renderCaptureViewButton()};a.prototype.taskThumbnailDownloadDone=function(a,b,c){a=
h.ArrayBufferToBase64(c);c=goog.dom.getElementByClass("task-view-image");d.Hide(b);c.src="data:image/png;base64, "+a;this.showTaskImage()};a.prototype.showViewRefreshButton=function(){goog.dom.getElementByClass("task-view-image-refresh-button").classList.remove("invisible")};a.prototype.referenceModelThumbnailDownloadDone=function(a,b){var c=h.ArrayBufferToBase64(b),e=document.getElementById(a.id),e=goog.dom.getElementByClass("ref-icon",e);goog.isDefAndNotNull(e)&&(e.src="data:image/png;base64, "+
c)};a.prototype.setLocalTaskImage=function(a){goog.dom.getElementByClass("task-view-image").src=a;this.showTaskImage()};a.prototype.hideTaskImage=function(){goog.dom.getElementByClass("task-view-image").classList.add("invisible");this.showCaptureViewButton()};a.prototype.showTaskImage=function(){var a=goog.dom.getElementByClass("task-view-image");a.classList.remove("invisible");a.addEventListener("click",this.setClientView.bind(this));this.hideCaptureViewButton();this.showViewRefreshButton()};a.prototype.setClientView=
function(){var a=this;this.getAlignment(this.currentModelId).then(function(b){a.feedback_.setView(a.currentView_,b)})};a.prototype.hideCaptureViewButton=function(){var a=goog.dom.getElementByClass("capture-view-button-container");goog.isDefAndNotNull(a)&&a.classList.add("invisible")};a.prototype.showCaptureViewButton=function(){goog.dom.getElementByClass("capture-view-button-container").classList.remove("invisible")};a.prototype.getViewDetails=function(a){var b=this;this.currentView_=null;return goog.isDefAndNotNull(a)?
(a=this.trimbleConnect_.getViewDetails(this.currentRegion_,a.id),a.then(function(a){b.currentView_=a}),a.thenCatch(function(a){b.errorHandler_.rescue(a)}),a):goog.Promise.resolve()};a.prototype.setTaskView=function(a){a.projectId=this.currentProjectId_;this.currentView_=a};a.prototype.selectTask=function(a,b){this.deselectAllTasks();b.classList.add("selected");this.selectedTask_=b;this.enableButton(this.getDeleteButton())};a.prototype.deselectAllTasks=function(){for(var a=this.taskList_.getElementsByTagName("li"),
b=0;b<a.length;++b)a[b].classList.remove("selected");this.disableButton(this.getDeleteButton())};a.prototype.enableButton=function(a){a.classList.remove("disabled-button")};a.prototype.disableButton=function(a){a.classList.add("disabled-button")};a.prototype.getDeleteButton=function(){return goog.dom.getElementByClass("task-delete-button",this.content_)};a.prototype.getCommitButton=function(){return goog.dom.getElementByClass("commit-button",this.content_)};a.prototype.deleteTask=function(a){var b=
this;a.stopPropagation();if(goog.isDefAndNotNull(this.selectedTask_)){var c=this.selectedTask_.dataset.id;a=l.ShowQuestionDialog(g.$t("Are you sure you want to delete the selected ToDo? You cannot undo this."));a.then(function(a){if(a){var e=b.trimbleConnect_.deleteTask(b.currentRegion_,c);e.then(function(){b.renderTaskListView()});e.thenCatch(function(a){b.errorHandler_.rescue(a)})}return a});a.thenCatch(function(a){b.errorHandler_.rescue(a)})}};a.prototype.updateTask=function(a){var b=this;try{var c=
this.createTaskFromFormInput(),d=a.getDifference(c);d.assignees=c.assignees;d.dueDate=c.dueDate;d.priority=c.priority;this.disableButton(this.getCommitButton());c=void 0;c=this.trimbleConnect_.updateTask(this.currentRegion_,a.id,d);c=c.then(function(){return b.taskViewModified_?b.updateTaskView(a,b.currentView_):goog.Promise.resolve()});c.then(function(){l.ShowInfoDialog(g.$t("Info"),g.$t("ToDo Successfully Updated")).then(function(){b.openTab(e.TaskList)})});c.thenCatch(function(a){b.errorHandler_.rescue(a);
b.enableButton(b.getCommitButton())});return c}catch(f){return this.errorHandler_.rescue(f),this.enableButton(this.getCommitButton()),goog.Promise.reject(f)}};a.prototype.updateTaskView=function(a,b){var c=this,e=a.getViewAttachment();return(goog.isDefAndNotNull(e)?this.trimbleConnect_.removeAttachments(this.currentRegion_,a.id,a.attachments).then(function(){a.removeAllAttachments();return c.trimbleConnect_.deleteView(c.currentRegion_,e.id)}):goog.Promise.resolve()).then(function(){return c.publishTaskView(a)})};
a.prototype.openTask=function(a,b){var c=this;b.stopPropagation();var e=a.dataset.id;this.currentTaskId_=e;this.clearContent();d.Show(this.content_);var g;this.currentModelTasks_.forEach(function(a){a.id==e&&(g=a)});var f=g.getViewAttachment();this.getViewDetails(f).then(function(){d.Hide(c.content_);c.renderEditTaskView(g)}).thenCatch(function(a){c.errorHandler_.rescue(a);c.renderTaskListView()})};a.prototype.publishTask=function(){var a=this,b;try{this.disableButton(this.getCommitButton());b=this.createTaskFromFormInput();
var c=this.trimbleConnect_.publishTask(this.currentRegion_,this.currentProjectId_,b),d;c.then(function(b){d=b;return a.attachModel(d)}).then(function(b){return a.publishTaskView(d)}).then(function(){return l.ShowInfoDialog(g.$t("Info"),g.$t("ToDo Successfully Published"))}).then(function(){a.openTab(e.TaskList)});c.thenCatch(function(b){a.errorHandler_.rescue(b);a.enableButton(a.getCommitButton())});return c}catch(f){return this.errorHandler_.rescue(f),this.enableButton(this.getCommitButton()),goog.Promise.reject(f)}};
a.prototype.attachModel=function(a){goog.isDefAndNotNull(this.currentView_)?a=goog.Promise.resolve():(a.addAttachment(this.currentModelId_,m.Type.file),a=this.trimbleConnect_.publishTaskAttachments(this.currentRegion_,this.currentProjectId_,a,a.attachments));return a};a.prototype.setViewPropertiesFromTask=function(a){a=g.$t("ToDo View: ")+a.label;this.currentView_.name=a;this.currentView_.description=a};a.prototype.publishTaskView=function(a){var b=this,c;goog.isDefAndNotNull(this.currentView_)?(this.setViewPropertiesFromTask(a),
c=this.trimbleConnect_.publishView(this.currentRegion_,this.currentProjectId_,this.currentView_),c.then(function(c){a.addAttachment(c.id,m.Type.view);return b.trimbleConnect_.publishTaskAttachments(b.currentRegion_,b.currentProjectId_,a,a.attachments)})):c=goog.Promise.resolve();return c};a.prototype.createTaskFromFormInput=function(){var a=goog.dom.getElementByClass("task-name-input"),b=goog.dom.getElementByClass("task-description-input"),c=goog.dom.getElementByClass("due-date-input"),e=goog.dom.getElementByClass("priority-input"),
d=goog.dom.getElementByClass("status-input"),g=goog.dom.getElementByClass("assign-task-input"),a={description:goog.string.trim(b.value),projectId:this.currentProjectId_,label:goog.string.trim(a.value),status:d.value,priority:e.value,dueDate:c.value,assignees:this.getAssigneesFromInputField(g)},a=this.validateTaskInput(a);return new m.Task(a)};a.prototype.getAssigneesFromInputField=function(a){a=goog.string.splitLimit(a.value,",",this.MAX_ASSIGNEES);a.forEach(function(a,b,c){c[b]=goog.string.trim(a)});
goog.array.removeAllIf(a,function(a,b,c){return goog.string.isEmpty(a)});var b=[],c=this.getUserFullNameIdMap(),e=this.getGroupNameIdMap();a.forEach(function(a){for(var d in c)c[d]==a&&b.push({id:d,type:m.Type.user});for(d in e)e[d]==a&&b.push({id:d,type:m.Type.group})});if(a.length!=b.length)throw Error("INVALID_ASSIGNEE");return b};a.prototype.validateTaskInput=function(a){if(Date.parse(a.dueDate)){var b=f.ISODateString(new Date(a.dueDate)),b=f.fixDueDate(b);a.dueDate=b}else delete a.dueDate;if(goog.string.isEmpty(a.description))throw Error("MISSING_TODO_DESCRIPTION");
return a};a.prototype.hideElement=function(a){a.classList.add("invisible")};a.prototype.showElement=function(a){a.classList.remove("invisible")};a.prototype.clearContent=function(){goog.dom.removeChildren(this.content_)};return a}();a.TaskDialogWidget=n;var r;(function(a){a.handleCommitOrCancelClick=function(a,b,c){a.querySelector(".commit-button").addEventListener("click",b.bind(this));a.querySelector(".cancel-button").addEventListener("click",c.bind(this))}})(r=a.TaskDlg||(a.TaskDlg={}))});
define("ReferenceListView","require exports TC-Object l10n ModelStorageProvider DialogPrompts DateHelper XhrUtils TaskDialogWidget".split(" "),function(n,a,l,k,d,f,h,g,m){Object.defineProperty(a,"__esModule",{value:!0});a.ReferenceListView=void 0;n=function(){function a(b,c,d){this.parent_=b;this.localReferences_=c;this.feedback_=d;this.versionStateMap_={};this.remoteReferences_=[];this.progressElements_=[]}a.prototype.render=function(){var a=goog.soy.renderAsFragment(SketchUpTemplates.referenceList,
{});this.parent_.appendChild(a);this.content_=a;this.renderActionBar();this.renderCommitCancel();this.renderList()};a.prototype.addRemoteReference=function(a){this.remoteReferences_.push(a)};a.prototype.updateLocalReference=function(a){var c=this.getReferenceById(a.id,this.localReferences_),c=this.localReferences_.indexOf(c);this.localReferences_[c]=a};a.prototype.syncAlignment=function(a,c){var d=this.getReferenceById(a,this.remoteReferences_),d=this.remoteReferences_.indexOf(d),g=this.getReferenceById(a,
this.localReferences_),g=this.localReferences_.indexOf(g);this.remoteReferences_[d].alignment=c;this.localReferences_[g].alignment=c;this.displayAlignmentStateSatus();this.displayVersionStateStatus(a)};a.prototype.refreshFileStatus=function(a){this.deleteProgressBar(a);this.compareLocalAndRemote(a);this.displayAlignmentStateSatus();this.displayVersionStateStatus(a)};a.prototype.renderActionBar=function(){var a=goog.soy.renderAsFragment(SketchUpTemplates.refActionsBar,{});this.parent_.appendChild(a);
this.actionBar_=a;this.handleActionBarEvents()};a.prototype.renderCommitCancel=function(){var a={cancelText:k.$t("Revert"),cancelTooltip:k.$t("Revert to the latest published model alignment"),commitText:k.$t("Upload"),commitTooltip:k.$t("Publish the alignment changes to Trimble Connect")},a=goog.soy.renderAsFragment(SketchUpTemplates.commitOrCancel,a);m.TaskDlg.handleCommitOrCancelClick(a,this.updateAlignment.bind(this),this.revertAlignment.bind(this));this.content_.appendChild(a)};a.prototype.updateAlignment=
function(){this.disableButton(this.getCommitButton());this.feedback_.publishAlignment(this.selectedReference_.id)};a.prototype.revertAlignment=function(){var a=this;this.disableButton(this.getCancelButton());this.feedback_.revertAlignment(this.selectedReference_.id).then(function(){a.enableButton(a.getCancelButton())})};a.prototype.handleActionBarEvents=function(){this.actionBar_.querySelector(".ref-add-button").addEventListener("click",this.addReference.bind(this));this.actionBar_.querySelector(".ref-delete-button").addEventListener("click",
this.deleteReference.bind(this));this.getUpdateAllButton().addEventListener("click",this.updateAllReferences.bind(this))};a.prototype.addReference=function(){this.feedback_.addReference()};a.prototype.deleteReference=function(){var a=this;goog.isDefAndNotNull(this.selectedReference_)&&goog.isDefAndNotNull(this.selectedReference_.id)&&f.ShowQuestionDialog(k.$t("Remove selected reference model?")).then(function(c){c&&a.feedback_.deleteReference(a.selectedReference_.id)})};a.prototype.updateAllReferences=
function(){var a=this;f.ShowQuestionDialog(k.$t("Update all References?")).then(function(c){c&&(a.deselectAllReferences(),a.localReferences_.forEach(function(c,e,g){a.versionStateMap_[c.id]==d.FileVersionState.ModifiedAtRemoteStorage&&a.doUpdateReference(c)}))})};a.prototype.updateReference=function(a){var c=this;f.ShowQuestionDialog(k.$t("Update model from Trimble Connect?")).then(function(d){d&&(c.deselectAllReferences(),c.doUpdateReference(a))})};a.prototype.doUpdateReference=function(a){var c=
this.getReferenceById(a.id,this.remoteReferences_);null==c?f.ShowInfoDialog(k.$t("Error"),k.$t("Unable to locate the remote Trimble Connect model for the reference: ")+a.name):(this.disableSyncButton(a.id),this.addProgressBar(this.setupProgressBar(a)),this.feedback_.updateReference(c))};a.prototype.disableSyncButton=function(a){a=document.getElementById(a);this.displaySyncedStatus(a)};a.prototype.addProgressBar=function(a){this.progressElements_.push(a)};a.prototype.deleteProgressBar=function(a){a=
this.getProgressBarById(a);goog.isDefAndNotNull(a)&&(a=this.progressElements_.indexOf(a),goog.dom.removeNode(this.progressElements_[a].progressElement),this.progressElements_.splice(a,1))};a.prototype.getProgressBarById=function(a){for(var c=0;c<this.progressElements_.length;++c){var d=this.progressElements_[c];if(d.id==a)return d}return null};a.prototype.setupProgressBar=function(a){var c=document.getElementById(a.id),d=goog.soy.renderAsFragment(SketchUpTemplates.listItemProgress);c.appendChild(d);
var f=goog.dom.getElementByClass("progress-bar",d);return{id:a.id,progressElement:f,onProgress:function(a){f.value=g.ComputeProgressPercentage(a)}}};a.prototype.updateProgress=function(a,c){for(var d=0;d<this.progressElements_.length;++d){var g=this.progressElements_[d];if(g.id==c)g.onProgress(a)}};a.prototype.renderList=function(){this.refList_=this.content_.querySelector(".ref-list-container ul");for(var a=0;a<this.localReferences_.length;++a)this.renderSingleReference(this.localReferences_[a]);
0==this.localReferences_.length&&this.notifyEmptyList();this.deselectAllReferences()};a.prototype.renderSingleReference=function(a){var c=goog.soy.renderAsFragment(SketchUpTemplates.referenceEntry,{reference:a,thumbnail:null,hasConflict:null}),d=goog.dom.getElementByClass("ref-list-item",c);d.addEventListener("click",this.selectReference.bind(this,c,a));d.addEventListener("dblclick",this.editAlignment.bind(this,c,a));goog.dom.getElementByClass("ref-update-button",c).addEventListener("click",this.updateReference.bind(this,
a));d=goog.dom.getElementByClass("accordian-chevron",c);d.addEventListener("click",this.toggleEditAlignment.bind(this,c,a,d));this.refList_.appendChild(c)};a.prototype.toggleEditAlignment=function(a,c){this.alignmentEditor_?this.selectReference(a,c):this.editAlignment(a,c)};a.prototype.notifyEmptyList=function(){var a=k.$t("This model has no reference models.");this.refList_.appendChild(goog.soy.renderAsFragment(SketchUpTemplates.emptyList,{message:a}))};a.prototype.selectReference=function(a,c){this.deselectAllReferences();
a.classList.add("selected");this.selectedEntry_=a;this.enableButton(this.getDeleteButton());this.enableButton(this.getUpdateButton());this.selectedReference_=c;this.feedback_.selectReference(c.id)};a.prototype.editAlignment=function(a,c){this.feedback_.editAlignment(c.id)};a.prototype.loadAlignmentView=function(a,c,d){this.getReferenceById(this.selectedReference_.id,this.localReferences_).alignment=a;goog.isDefAndNotNull(this.alignmentEditor_)?this.populateAlignmentFields(d):(this.rotateChevron(this.selectedEntry_),
this.renderAlignmentEditor(c,d),this.loadCreator(),this.loadModifier(),this.handleAlignmentViewEvents());this.displayAlignmentStateSatus()};a.prototype.rotateChevron=function(a){goog.dom.getElementByClass("accordian-chevron",a).classList.add("expanded")};a.prototype.unrotateChevron=function(a){goog.dom.getElementByClass("accordian-chevron",a).classList.remove("expanded")};a.prototype.renderAlignmentEditor=function(a,c){var d={position:{x:c.positionX,y:c.positionY,z:c.positionZ},rotation:{x:c.rotationX,
y:c.rotationY,z:c.rotationZ},lengthUnit:c.lengthUnit,angleUnit:String.fromCharCode(176)};this.alignmentEditor_=goog.soy.renderAsFragment(SketchUpTemplates.editAlignment,d);this.selectedEntry_.appendChild(this.alignmentEditor_);this.enableButton(this.getCommitButton());this.enableButton(this.getCancelButton())};a.prototype.populateAlignmentFields=function(a){var c=goog.dom.getElementByClass("pos-x-input"),d=goog.dom.getElementByClass("pos-y-input"),g=goog.dom.getElementByClass("pos-z-input"),f=goog.dom.getElementByClass("rot-x-input"),
h=goog.dom.getElementByClass("rot-y-input"),m=goog.dom.getElementByClass("rot-z-input");c.value=a.positionX;d.value=a.positionY;g.value=a.positionZ;f.value=a.rotationX;h.value=a.rotationY;m.value=a.rotationZ};a.prototype.loadCreator=function(){var a=this.getReferenceById(this.selectedReference_.id,this.remoteReferences_);if(goog.isDefAndNotNull(a)){var c=new l.User(a.createdBy),a={data:{label:k.$t("Created By:"),thumbnail:null,initials:c.getInitials(),name:c.displayName(),timestamp:h.convertTimeStamp(a.createdOn)}},
a=goog.soy.renderAsFragment(SketchUpTemplates.authorDetails,a);this.alignmentEditor_.appendChild(a)}};a.prototype.loadModifier=function(){var a=this.getReferenceById(this.selectedReference_.id,this.remoteReferences_);if(goog.isDefAndNotNull(a)){var c=new l.User(a.modifiedBy),a={data:{label:k.$t("Last Edited By:"),thumbnail:null,initials:c.getInitials(),name:c.displayName(),timestamp:h.convertTimeStamp(a.modifiedOn)}},a=goog.soy.renderAsFragment(SketchUpTemplates.authorDetails,a);this.alignmentEditor_.appendChild(a)}};
a.prototype.handleAlignmentViewEvents=function(){goog.dom.getElementByClass("align-button-container",this.selectedEntry_).addEventListener("click",this.launchAlignmentTool.bind(this));for(var a=document.querySelectorAll(".alignment-input"),c=0;c<a.length;++c)a[c].addEventListener("keyup",this.positionReference.bind(this,a))};a.prototype.launchAlignmentTool=function(){this.feedback_.launchAlignmentTool(this.selectedReference_.id)};a.prototype.positionReference=function(a){var c={};a.forEach(function(a,
b,d){c[a.classList.item(1)]=a.value});this.showUpdateAlignmentButton();this.feedback_.positionReference(this.selectedReference_.id,c)};a.prototype.showUpdateAlignmentButton=function(){this.content_.querySelector(".commit-cancel-container").classList.add("visible");this.content_.classList.add("compressed")};a.prototype.hideUpdateAlignmentButton=function(){this.content_.querySelector(".commit-cancel-container").classList.remove("visible");this.content_.classList.remove("compressed")};a.prototype.deselectAllReferences=
function(){for(var a=this.refList_.getElementsByTagName("li"),c=0;c<a.length;++c)a[c].classList.remove("selected");this.disableButton(this.getDeleteButton());goog.isDefAndNotNull(this.alignmentEditor_)&&(goog.dom.removeNode(this.alignmentEditor_),this.unrotateChevron(this.selectedEntry_));this.hideUpdateAlignmentButton();this.selectedReference_=this.alignmentEditor_=null};a.prototype.enableButton=function(a){a.classList.remove("disabled-button")};a.prototype.disableButton=function(a){a.classList.add("disabled-button")};
a.prototype.getDeleteButton=function(){return goog.dom.getElementByClass("ref-delete-button",this.actionBar_)};a.prototype.getUpdateAllButton=function(){return goog.dom.getElementByClass("ref-update-button",this.actionBar_)};a.prototype.getCommitButton=function(){return goog.dom.getElementByClass("commit-button",this.content_)};a.prototype.getCancelButton=function(){return goog.dom.getElementByClass("cancel-button",this.content_)};a.prototype.getUpdateButton=function(){return goog.dom.getElementByClass("ref-update-button",
this.actionBar_)};a.prototype.compareLocalAndRemote=function(a){var c=this.getReferenceById(a,this.localReferences_),g=this.getReferenceById(a,this.remoteReferences_);goog.isDefAndNotNull(c)&&goog.isDefAndNotNull(g)?g.versionId==c.versionId?this.versionStateMap_[a]=d.FileVersionState.UpToDate:this.getNewest(c,g)==g?this.versionStateMap_[a]=d.FileVersionState.ModifiedAtRemoteStorage:this.versionStateMap_[a]=d.FileVersionState.ModifiedLocally:(goog.isDefAndNotNull(c),this.versionStateMap_[a]=d.FileVersionState.DeleteAtRemoteStorage)};
a.prototype.displayVersionStateStatus=function(a){var c=document.getElementById(a);switch(this.versionStateMap_[a]){case d.FileVersionState.ModifiedAtRemoteStorage:this.displayRemoteModifiedStatus(c);break;case d.FileVersionState.DeleteAtRemoteStorage:this.displayDeletedStatus(c);break;default:this.displaySyncedStatus(c)}};a.prototype.displayAlignmentStateSatus=function(){if(goog.isDefAndNotNull(this.selectedReference_)&&goog.isDefAndNotNull(this.alignmentEditor_)){var a=this.getReferenceById(this.selectedReference_.id,
this.remoteReferences_),c=this.getReferenceById(this.selectedReference_.id,this.localReferences_);goog.isDefAndNotNull(a)&&!this.hasSameAlignment(c.alignment,a.alignment)?this.showUpdateAlignmentButton():this.hideUpdateAlignmentButton()}};a.prototype.displayRemoteModifiedStatus=function(a){goog.dom.getElementByClass("ref-update-button",a).classList.remove("invisible");this.shrinkRefName(a)};a.prototype.displayDeletedStatus=function(a){var c=k.$t("The model has been deleted from Trimble Connect");
a.title=c;a.classList.add("reference-not-found")};a.prototype.shrinkRefName=function(a){goog.dom.getElementByClass("ref-list-item-name",a).classList.add("shrink")};a.prototype.unshrinkRefName=function(a){goog.dom.getElementByClass("ref-list-item-name",a).classList.remove("shrink")};a.prototype.displaySyncedStatus=function(a){goog.dom.getElementByClass("ref-update-button",a).classList.add("invisible");this.unshrinkRefName(a)};a.prototype.getNewest=function(a,c){return new Date(a.modifiedOn)<new Date(c.modifiedOn)?
c:a};a.prototype.getReferenceById=function(a,c){for(var d=0;d<c.length;++d){var g=c[d];if(g.id==a)return g}return null};a.prototype.hasSameAlignment=function(a,c){var d=!1;goog.math.nearlyEquals(a.axisX,c.axisX)&&goog.math.nearlyEquals(a.axisY,c.axisY)&&goog.math.nearlyEquals(a.axisZ,c.axisZ)&&goog.math.nearlyEquals(a.locationX,c.locationX)&&goog.math.nearlyEquals(a.locationY,c.locationY)&&goog.math.nearlyEquals(a.locationZ,c.locationZ)&&goog.math.nearlyEquals(a.refDirectionX,c.refDirectionX)&&goog.math.nearlyEquals(a.refDirectionY,
c.refDirectionY)&&goog.math.nearlyEquals(a.refDirectionZ,c.refDirectionZ)&&(d=!0);return d};return a}();a.ReferenceListView=n});
define("ViewerWidget",["require","exports","ModelStorageProviderFactory"],function(n,a,l){Object.defineProperty(a,"__esModule",{value:!0});a.ViewerWidget=void 0;n=function(){function a(d){this.parent_=d;this.trimbleConnect_=l.Providers[l.ProviderKey.Trimble_Connect]}a.prototype.open=function(a){var f=this,h=this.trimbleConnect_.initialize(a),g=this.trimbleConnect_.baseURL("northAmerica");h.then(function(){var h=goog.dom.getElementByClass("trimble-connect-viewer");a.domNode=h;a.gteamOrigin=encodeURIComponent(g);
a.accessToken=f.trimbleConnect_.token;new EmbeddedViewer(a)})};return a}();a.ViewerWidget=n});define("main-progress",["require","exports","ModelStorageProviderFactory","ProgressDialog"],function(n,a,l,k){Object.defineProperty(a,"__esModule",{value:!0});l.Init();window.ProgressDlg={show:function(a){this.dialog=new k.UploadProgressDialog(document.body);this.dialog.open(a)},updateProgress:function(a){this.dialog.updateProgress(a)},error:function(a){this.dialog.processFileTransferError(a)}};window.sketchup.ready()});
define("main-task",["require","exports","TaskDialogWidget","ModelStorageProviderFactory","LoadingGif"],function(n,a,l,k,d){Object.defineProperty(a,"__esModule",{value:!0});d.Show(document.body);k.Init();window.TaskDialog={dialog:null,trimbleConnect:k.Providers[k.ProviderKey.Trimble_Connect],show:function(a){d.Hide(document.body);this.dialog=new l.TaskDialogWidget(document.body,new f);this.dialog.open(a)},setTaskImage:function(a){this.dialog.setLocalTaskImage(a)},setTaskView:function(a){this.dialog.setTaskView(a)},
renderReferencesView:function(a){this.dialog.renderReferencesViewCallback(a)},renderAlignmentView:function(a,d,f){this.dialog.loadAlignment(a,d,f)},updateProgress:function(a,d){this.dialog.updateProgress(a,d)},updateReferenceStatus:function(a){this.dialog.updateReferenceStatus(a)},publishAlignment:function(a,d){this.dialog.publishAlignment(a,d)}};var f=function(){function a(){}a.prototype.openTrimbleConnect=function(){window.sketchup.open_trimble_connect()};a.prototype.renderReferencesView=function(){this.getBaseAlignment().then(function(a){window.sketchup.render_references_view(JSON.stringify(a))})};
a.prototype.addReference=function(){this.getBaseAlignment().then(function(a){window.sketchup.add_reference(JSON.stringify(a))})};a.prototype.deleteReference=function(a){this.getBaseAlignment().then(function(d){window.sketchup.delete_reference(a,JSON.stringify(d))})};a.prototype.selectReference=function(a){window.sketchup.select_reference(a)};a.prototype.updateReference=function(a){var d=window.TaskDialog.dialog.currentRegionLocation,c={token:window.TaskDialog.trimbleConnect.token,baseURL:window.TaskDialog.trimbleConnect.baseURL(d),
fileId:a.id,versionId:a.versionId,fileName:a.name,thumbnailURL:a.thumbnailUrl[0],createdOn:a.createdOn,modifiedOn:a.modifiedOn,size:a.size,projectId:a.projectId,parentId:a.parentId,location:d,remoteIdPath:null,alignment:a.alignment};this.getBaseAlignment().then(function(a){window.sketchup.update_reference(JSON.stringify(c),JSON.stringify(a))})};a.prototype.editAlignment=function(a){this.getBaseAlignment().then(function(d){window.sketchup.edit_alignment(a,JSON.stringify(d))})};a.prototype.launchAlignmentTool=
function(a){this.getAlignment(a).then(function(d){window.sketchup.launch_alignment_tool(a,JSON.stringify(d))})};a.prototype.positionReference=function(a,d){window.sketchup.position_reference(a,JSON.stringify(d))};a.prototype.revertAlignment=function(a){var d,c;a=this.getAlignment(a);var b=this.getBaseAlignment();return goog.Promise.all([a,b]).then(function(a){d=a[0];c=a[1];window.sketchup.revert_alignment(JSON.stringify(d),JSON.stringify(c))})};a.prototype.publishAlignment=function(a){this.getBaseAlignment().then(function(d){window.sketchup.publish_alignment(a,
JSON.stringify(d))})};a.prototype.captureView=function(a){window.sketchup.capture_view(JSON.stringify(a))};a.prototype.setView=function(a,d){var c=JSON.stringify(a),b=JSON.stringify(d);window.sketchup.set_view(c,b)};a.prototype.getBaseAlignment=function(){return this.getAlignment(window.TaskDialog.dialog.currentModelId)};a.prototype.getAlignment=function(a){return window.TaskDialog.trimbleConnect.getAlignment(window.TaskDialog.dialog.currentRegionLocation,a)};return a}();window.sketchup.ready()});
define("main-viewer",["require","exports","ViewerWidget","ModelStorageProviderFactory"],function(n,a,l,k){Object.defineProperty(a,"__esModule",{value:!0});k.Init();window.ViewerDialog={dialog:null,trimbleConnect:k.Providers[k.ProviderKey.Trimble_Connect],show:function(a){console.log(a);this.viewDialog=new l.ViewerWidget(document.body);this.viewDialog.open(a)}};window.sketchup.ready()});
define("main","require exports OpenDialogWidget FileManager ModelStorageProviderFactory FileUtils".split(" "),function(n,a,l,k,d,f){Object.defineProperty(a,"__esModule",{value:!0});var h=function(){function a(){}a.prototype.openFile=function(a){window.TCE.fileDialog.disableOpenButton();this.setupDownloadRequest(a).then(function(a){window.TCE.fileDialog.setupDownloadProgressDialog();window.sketchup.download_file(JSON.stringify(a))}).thenAlways(function(){window.TCE.fileDialog.enableOpenButton()})};
a.prototype.deleteFile=function(a){window.TCE.fileDialog.getFolderAncestorListNoCache(window.TCE.fileDialog.currentFolderId,window.TCE.fileDialog.currentRegionLocation).then(function(c){c=k.FileManager.getInstance().makeFolderIdPathFromAncestorList(c);c=goog.string.path.join(c,a.remoteId);window.sketchup.delete_file(c,JSON.stringify(a))})};a.prototype.importReferenceFile=function(a){window.TCE.fileDialog.disableOpenButton();this.setupDownloadRequest(a).then(function(a){window.TCE.fileDialog.setupImportProgressDialog();
window.sketchup.import_file(JSON.stringify(a))}).thenAlways(function(){window.TCE.fileDialog.enableOpenButton()})};a.prototype.publishFile=function(a,c){window.TCE.fileDialog.disablePublishButton();c=f.getValidSKPName(c);var b=window.TCE.fileDialog.currentRegionLocation,d=window.TCE.fileDialog.currentProjectId,g=window.TCE.fileDialog.currentModelId,h=null,l=null,n;n=goog.isDefAndNotNull(g)?window.TCE.trimbleConnect.getFileDetails(b,g):goog.Promise.resolve(null);var w;w=window.TCE.fileDialog.getFolderAncestorListNoCache(a,
b);n.then(function(a){a&&(h=a.versionId,l=a.name);return w}).thenCatch(function(a){return w}).then(function(f){f=k.FileManager.getInstance().makeFolderIdPathFromAncestorList(f);f={token:window.TCE.trimbleConnect.token,baseURL:window.TCE.trimbleConnect.baseURL(b),fileName:c,projectId:d,parentId:a,location:b,remoteIdPath:f,versionId:h,fileId:g,remoteFileName:l};window.sketchup.publish_file(JSON.stringify(f))}).thenAlways(function(){window.TCE.fileDialog.enablePublishButton()})};a.prototype.setupDownloadRequest=
function(a){var c=window.TCE.fileDialog.currentRegionLocation,b=window.TCE.fileDialog.currentProjectId,d=window.TCE.fileDialog.currentFolderId,f=(new Date(a.createdOn)).toUTCString(),g=(new Date(a.modifiedOn)).toUTCString(),h;h=window.TCE.fileDialog.getFolderAncestorListNoCache(d,c);var l,n;l=window.TCE.trimbleConnect.getAlignment(c,a.remoteId);n=window.TCE.fileDialog.currentModelId;n=goog.isDefAndNotNull(n)?window.TCE.trimbleConnect.getAlignment(c,n):goog.Promise.resolve(null);var u,v,x;return goog.Promise.all([l,
n,h]).then(function(h){u=h[0];v=h[1];console.log(u);console.log(v);x=h[2];h=k.FileManager.getInstance().makeFolderIdPathFromAncestorList(x);return{token:window.TCE.trimbleConnect.token,baseURL:window.TCE.trimbleConnect.baseURL(c),fileId:a.remoteId,versionId:a.remoteVersionId,fileName:a.name,thumbnailURL:a.thumbnailURL,createdOn:f,modifiedOn:g,size:1024*a.sizeInKB,projectId:b,parentId:d,location:c,remoteIdPath:h,alignment:u,baseAlignment:v}})};a.prototype.cancelFileTransfer=function(){window.sketchup.cancel_file_transfer()};
return a}();d.Init();window.TCE={fileDialog:null,trimbleConnect:d.Providers[d.ProviderKey.Trimble_Connect],showFileDialog:function(a){this.fileDialog=new l.OpenDialogWidget(document.body,new h);this.fileDialog.open(a)},deleteItem:function(a){a=JSON.parse(a);this.fileDialog.doDeleteFileItem(a)},updateProgressDialog:function(a){this.fileDialog.updateProgressDialog(a)},error:function(a){this.fileDialog.processFileTransferError(a)}};window.sketchup.ready()});
